{% extends "payroll_base.html" %}

{% block title %}Login-Payroll{% endblock %}

{% block content %}

<div class="login-container">
    <div class="login-card">
        <div class="login-header">
            <div class="logo-placeholder">
                <img src="{{ url_for('payroll_auth.static', filename='img/logo2.avif') }}" alt="Logo" width="150" height="150" class="rounded-logo">
            </div>
            <h2>Sign In</h2>
            <p>Enter your credentials to continue</p>
        </div>
        
        <form class="login-form" id="loginForm" method="POST" action="{{ url_for('payroll_auth.login') }}">
            {{ form.hidden_tag() }}

            <div class="form-group">
                <div class="input-wrapper">
                    {{ form.email(class="form-control", id="email", required=True, autocomplete="email") }}
                    <label for="email">Email</label>
                </div>
                {% if form.email.errors %}
                    <span class="error-message">{{ form.email.errors[0] }}</span>
                {% endif %}
            </div>

            <div class="form-group">
                <div class="input-wrapper">
                    {{ form.password(class="form-control", id="password", required=True, autocomplete="current-password") }}
                    <label for="password">Password</label>
                    
                    <button type="button" class="password-toggle" id="passwordToggle" onclick="togglePassword()" aria-label="Toggle password visibility">
                        <span class="toggle-icon">üëÅ</span>
                    </button>
                </div>
                {% if form.password.errors %}
                    <span class="error-message">{{ form.password.errors[0] }}</span>
                {% endif %}
            </div>

            <div class="form-options">
                <div class="remember-wrapper">
                    {{ form.remember() }}
                    <label for="remember" class="checkbox-label">
                        <span class="checkmark"></span>
                        Remember me
                    </label>
                </div>
            </div>

            <button type="submit" class="login-btn">
                <span class="btn-text">Sign In</span>
                <span class="btn-loader"></span>
            </button>
        </form>

        <div class="success-message" id="successMessage" style="display:none;">
            <div class="success-icon">‚úì</div>
            <h3>Welcome back!</h3>
            <p>Redirecting to your dashboard...</p>
        </div>
    </div>
</div>

<!-- SweetAlert2 CDN -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
function togglePassword() {
    const password = document.getElementById("password");
    const type = password.type === "password" ? "text" : "password";
    password.type = type;
}

// Check for flash messages from Flask
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      {% if category == 'danger' or category == 'error' %}
        Swal.fire({
          icon: 'error',
          title: 'Invalid Login',
          text: '{{ message }}',
          timer: 3000,
          showConfirmButton: false
        });
      {% elif category == 'success' %}
        Swal.fire({
          icon: 'success',
          title: 'Success',
          text: '{{ message }}',
          timer: 2000,
          showConfirmButton: false
        });
      {% endif %}
    {% endfor %}
  {% endif %}
{% endwith %}
</script>

{% endblock %}

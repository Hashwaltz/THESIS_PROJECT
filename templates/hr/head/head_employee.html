{% extends 'hr/head/head_base.html' %}
{% block title %}Department Head - Employees{% endblock %}

{% block content %}
<main class="p-6 space-y-6">

  <!-- Header -->
  <header class="mb-4">
    <h1 class="text-2xl font-bold text-blue-600">
      Employee Records â€” {{ department.name if department else "Unassigned Department" }}
    </h1>
  </header>

  <!-- Search & Export -->
  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6">
    <form method="get" action="{{ url_for('dept_head.employees') }}" class="flex gap-2 w-full sm:w-auto">
      <input type="text" name="search" value="{{ search }}" placeholder="Search employees..."
             class="px-3 py-2 rounded-lg border border-gray-600 bg-gray-700 text-gray-200 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 flex-1" />
      <button type="submit"
              class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-1">
        <span class="material-symbols-outlined">person_search</span> Search
      </button>
    </form>
    <a href="{{ url_for('dept_head.export_employees') }}"
       class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center gap-1">
       <span class="material-symbols-outlined">download</span> Export Excel
    </a>
  </div>

  <!-- Employee Table -->
  <div class="overflow-x-auto bg-gray-800 rounded-lg shadow-lg">
    <table class="min-w-full text-left text-gray-200 divide-y divide-gray-700">
      <caption class="text-lg font-semibold p-4">Employee List</caption>
      <thead class="bg-gray-900">
        <tr>
          <th class="px-4 py-2">Full Name</th>
          <th class="px-4 py-2">Email</th>
          <th class="px-4 py-2">Position</th>
          <th class="px-4 py-2">Date Hired</th>
          <th class="px-4 py-2">Status</th>
          <th class="px-4 py-2">Actions</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-700">
        {% for employee in employees %}
        <tr class="hover:bg-gray-700">
          <td class="px-4 py-2">{{ employee.get_full_name() }}</td>
          <td class="px-4 py-2">{{ employee.email }}</td>
          <td class="px-4 py-2">{{ employee.position.name if employee.position else '-' }}</td>
          <td class="px-4 py-2">{{ employee.date_hired.strftime('%Y-%m-%d') if employee.date_hired else '-' }}</td>
          <td class="px-4 py-2">
            <span class="{{ 'text-green-500' if employee.status == 'Active' else 'text-red-500' }}">
              {{ employee.status}}
            </span>
          </td>
          <td class="px-4 py-2">
            <a href="{{ url_for('dept_head.edit_employee', employee_id=employee.id) }}"
               class="px-3 py-1 bg-blue-600 text-white rounded-lg hover:bg-blue-700">View</a>
          </td>
        </tr>
        {% else %}
        <tr>
          <td colspan="7" class="px-4 py-4 text-center text-gray-400">No employees found.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <div class="flex justify-between items-center mt-4 text-gray-200">
    {% if employees.has_prev %}
    <a href="{{ url_for('dept_head.employees', page=employees.prev_num, search=search) }}"
       class="px-3 py-1 bg-gray-700 rounded hover:bg-gray-600">Previous</a>
    {% else %}
    <span></span>
    {% endif %}

    <span>Page {{ employees.page }} of {{ employees.pages }}</span>

    {% if employees.has_next %}
    <a href="{{ url_for('dept_head.employees', page=employees.next_num, search=search) }}"
       class="px-3 py-1 bg-gray-700 rounded hover:bg-gray-600">Next</a>
    {% else %}
    <span></span>
    {% endif %}
  </div>

  <!-- Absentees -->
  {% if absentees %}
  <section class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mt-6">
    {% for emp in absentees %}
    <div class="bg-red-800 p-4 rounded-lg shadow-lg flex items-center gap-4">
      <img src="{{ emp.photo if emp.photo else url_for('static', filename='images/user/user_logo.webp') }}"
           alt="{{ emp.get_full_name() }}"
           class="w-16 h-16 rounded-full object-cover">
      <div>
        <h2 class="font-semibold text-white">{{ emp.get_full_name() }}</h2>
        <p class="text-gray-300">{{ emp.position.name if emp.position else "No Position" }}</p>
        <p class="text-red-400 font-semibold">Absent</p>
      </div>
    </div>
    {% endfor %}
  </section>
  {% endif %}

  <!-- Late Arrivals -->
  {% if late_arrivals %}
  <section class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mt-6">
    {% for l in late_arrivals %}
    <div class="bg-yellow-800 p-4 rounded-lg shadow-lg flex items-center gap-4">
      <img src="{{ l.employee.photo if l.employee.photo else url_for('static', filename='images/user/user_logo.webp') }}"
           alt="{{ l.employee.get_full_name() }}"
           class="w-16 h-16 rounded-full object-cover">
      <div>
        <h2 class="font-semibold text-white">{{ l.employee.get_full_name() }}</h2>
        <p class="text-gray-300">{{ l.employee.position.name if l.employee.position else "No Position" }}</p>
        <p class="text-yellow-400 font-semibold">Late - {{ l.time_in.strftime('%H:%M') }}</p>
      </div>
    </div>
    {% endfor %}
  </section>
  {% endif %}

</main>
{% endblock %}

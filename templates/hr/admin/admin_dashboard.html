{% extends "payroll/admin/payroll_admin_base.html" %}

{% block title %}Payroll Dashboard{% endblock %}

{% block content %}
<section class="p-6">

  <!-- ===== HEADER ===== -->
  <h1 class="text-2xl font-semibold text-blue-400 mb-6 flex items-center gap-2">
    <span class="material-symbols-outlined text-3xl">payments</span>
    Payroll Dashboard
  </h1>

  <!-- ===== METRICS ===== -->
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">

    <div class="bg-gray-800 p-6 rounded-2xl shadow-lg border border-gray-700 flex items-center gap-4">
      <div class="p-3 bg-blue-600 bg-opacity-20 rounded-full">
        <span class="material-symbols-outlined text-blue-400 text-3xl">groups</span>
      </div>
      <div>
        <p class="text-gray-400">Total Employees</p>
        <h2 class="text-3xl font-bold text-blue-400 mt-2">{{ total_employees }}</h2>
      </div>
    </div>

    <div class="bg-gray-800 p-6 rounded-2xl shadow-lg border border-gray-700 flex items-center gap-4">
      <div class="p-3 bg-emerald-600 bg-opacity-20 rounded-full">
        <span class="material-symbols-outlined text-emerald-400 text-3xl">check_circle</span>
      </div>
      <div>
        <p class="text-gray-400">Employees Paid</p>
        <h2 class="text-3xl font-bold text-emerald-400 mt-2">{{ employees_paid }}</h2>
      </div>
    </div>

    <div class="bg-gray-800 p-6 rounded-2xl shadow-lg border border-gray-700 flex items-center gap-4">
      <div class="p-3 bg-yellow-500 bg-opacity-20 rounded-full">
        <span class="material-symbols-outlined text-yellow-400 text-3xl">hourglass_top</span>
      </div>
      <div>
        <p class="text-gray-400">Pending Payrolls</p>
        <h2 class="text-3xl font-bold text-yellow-400 mt-2">{{ pending_payrolls }}</h2>
      </div>
    </div>

    <div class="bg-gray-800 p-6 rounded-2xl shadow-lg border border-gray-700 flex items-center gap-4">
      <div class="p-3 bg-indigo-600 bg-opacity-20 rounded-full">
        <span class="material-symbols-outlined text-indigo-400 text-3xl">account_balance_wallet</span>
      </div>
      <div>
        <p class="text-gray-400">Total Payroll</p>
        <h2 class="text-2xl font-bold text-indigo-400 mt-2">
          ₱{{ "{:,.2f}".format(total_payroll_amount) }}
        </h2>
      </div>
    </div>

  </div>

  <!-- ===== SECOND ROW METRICS ===== -->
  <div class="grid grid-cols-1 sm:grid-cols-2 gap-6 mb-8">

    <div class="bg-gray-800 p-6 rounded-2xl shadow-lg border border-gray-700 flex items-center gap-4">
      <div class="p-3 bg-purple-600 bg-opacity-20 rounded-full">
        <span class="material-symbols-outlined text-purple-400 text-3xl">insights</span>
      </div>
      <div>
        <p class="text-gray-400">Average Salary</p>
        <h2 class="text-2xl font-bold text-purple-400 mt-2">
          ₱{{ "{:,.2f}".format(avg_salary) }}
        </h2>
      </div>
    </div>

    <div class="bg-gray-800 p-6 rounded-2xl shadow-lg border border-gray-700 flex items-center gap-4">
      <div class="p-3 bg-red-600 bg-opacity-20 rounded-full">
        <span class="material-symbols-outlined text-red-400 text-3xl">event_busy</span>
      </div>
      <div>
        <p class="text-gray-400">Approved Leaves</p>
        <h2 class="text-2xl font-bold text-red-400 mt-2">{{ leave_impact }}</h2>
      </div>
    </div>

  </div>

  <!-- ===== PAYROLL CHART ===== -->
  <div class="bg-gray-800 p-6 rounded-2xl shadow-lg border border-gray-700 mb-8">
    <h3 class="text-sm font-semibold text-blue-400 mb-4 flex items-center gap-2">
      <span class="material-symbols-outlined">trending_up</span>
      Monthly Payroll Trend
    </h3>
    <div class="relative h-[280px]">
      <canvas id="payrollChart"></canvas>
    </div>
  </div>

  <!-- ===== TABLES ===== -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

    <!-- Recent Payrolls -->
    <div class="bg-gray-800 p-6 rounded-2xl shadow-lg border border-gray-700">
      <h3 class="text-sm font-semibold text-blue-400 mb-4 flex items-center gap-2">
        <span class="material-symbols-outlined">history</span>
        Recent Payrolls
      </h3>

      <table class="w-full text-sm text-gray-300">
        <thead class="border-b border-gray-700">
          <tr>
            <th class="py-2 text-left">Employee</th>
            <th class="py-2 text-left">Net Pay</th>
            <th class="py-2 text-left">Status</th>
          </tr>
        </thead>
        <tbody>
          {% for payroll in recent_payrolls %}
          <tr class="border-b border-gray-700">
            <td class="py-2">{{ payroll.employee.full_name }}</td>
            <td class="py-2">₱{{ "{:,.2f}".format(payroll.net_pay) }}</td>
            <td class="py-2">
              <span class="px-2 py-1 rounded-full text-xs
                {% if payroll.status == 'Approved' %}
                  bg-emerald-600 bg-opacity-20 text-emerald-400
                {% else %}
                  bg-yellow-500 bg-opacity-20 text-yellow-400
                {% endif %}
              ">
                {{ payroll.status }}
              </span>
            </td>
          </tr>
          {% else %}
          <tr>
            <td colspan="3" class="py-4 text-center text-gray-500">No payroll records</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Pending Payrolls -->
    <div class="bg-gray-800 p-6 rounded-2xl shadow-lg border border-gray-700">
      <h3 class="text-sm font-semibold text-blue-400 mb-4 flex items-center gap-2">
        <span class="material-symbols-outlined">pending_actions</span>
        Pending Payrolls
      </h3>

      <ul class="space-y-3 text-gray-300">
        {% for payroll in pending_list %}
        <li class="flex justify-between">
          <span>{{ payroll.employee.full_name }}</span>
          <span class="text-yellow-400 font-semibold">{{ payroll.status }}</span>
        </li>
        {% else %}
        <li class="text-gray-500">No pending payrolls</li>
        {% endfor %}
      </ul>
    </div>

  </div>

  <!-- ===== PAYROLL PERIOD NOTICE ===== -->
  {% if upcoming_period %}
  <div class="bg-blue-600 bg-opacity-10 border border-blue-500 text-blue-400 rounded-xl p-4 mt-8">
    <strong>Open Payroll Period:</strong>
    {{ upcoming_period.start_date }} – {{ upcoming_period.end_date }}
  </div>
  {% endif %}

</section>

<!-- ===== CHART JS ===== -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
  const labels = {{ chart_labels | default([]) | tojson }};
  const values = {{ chart_values | default([]) | tojson }};

  new Chart(document.getElementById('payrollChart'), {
    type: 'line',
    data: {
      labels: labels,
      datasets: [{
        label: 'Total Payroll',
        data: values,
        borderColor: '#60a5fa',
        backgroundColor: '#60a5fa33',
        tension: 0.4,
        fill: true
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { labels: { color: '#d1d5db' } }
      },
      scales: {
        x: { ticks: { color: '#9ca3af' } },
        y: {
          ticks: {
            color: '#9ca3af',
            callback: value => '₱' + value.toLocaleString()
          }
        }
      }
    }
  });
});
</script>

{% endblock %}

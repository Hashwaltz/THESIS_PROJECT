{% extends 'hr/admin/admin_base.html' %}
{% block title %}Dashboard | HR Admin{% endblock %}
{% block content %}

<section class="p-6">

  <!-- Header -->
  <h1 class="text-2xl font-semibold text-blue-400 mb-6 flex items-center gap-2">
    <span class="material-symbols-outlined text-3xl">dashboard</span>
    HR Dashboard
  </h1>

  <!-- Stats Overview -->
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
    <div class="bg-gray-800 p-6 rounded-2xl shadow-lg border border-gray-700 flex items-center gap-4">
      <div class="p-3 bg-blue-600 bg-opacity-20 rounded-full">
        <span class="material-symbols-outlined text-blue-400 text-3xl">groups</span>
      </div>
      <div>
        <p class="text-gray-400">Total Employees</p>
        <h2 class="text-3xl font-bold text-blue-400 mt-2">{{ total_employees }}</h2>
      </div>
    </div>

    <div class="bg-gray-800 p-6 rounded-2xl shadow-lg border border-gray-700 flex items-center gap-4">
      <div class="p-3 bg-emerald-600 bg-opacity-20 rounded-full">
        <span class="material-symbols-outlined text-emerald-400 text-3xl">person</span>
      </div>
      <div>
        <p class="text-gray-400">Active Employees</p>
        <h2 class="text-3xl font-bold text-emerald-400 mt-2">{{ active_employees }}</h2>
      </div>
    </div>

    <div class="bg-gray-800 p-6 rounded-2xl shadow-lg border border-gray-700 flex items-center gap-4">
      <div class="p-3 bg-yellow-400 bg-opacity-20 rounded-full">
        <span class="material-symbols-outlined text-yellow-400 text-3xl">apartment</span>
      </div>
      <div>
        <p class="text-gray-400">Total Departments</p>
        <h2 class="text-3xl font-bold text-yellow-400 mt-2">{{ total_departments }}</h2>
      </div>
    </div>

    <div class="bg-gray-800 p-6 rounded-2xl shadow-lg border border-gray-700 flex items-center gap-4">
      <div class="p-3 bg-pink-400 bg-opacity-20 rounded-full">
        <span class="material-symbols-outlined text-pink-400 text-3xl">event_available</span>
      </div>
      <div>
        <p class="text-gray-400">Monthly Attendance</p>
        <h2 class="text-3xl font-bold text-pink-400 mt-2">
          {% if attendance_counts|length > 0 %}
            {{ (attendance_counts|sum / attendance_counts|length)|round(2) }}%
          {% else %}
            0%
          {% endif %}
        </h2>
      </div>
    </div>
  </div>

  <!-- Top Components: Reminders, Quick Actions, Notes -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">

    <!-- Reminders -->
    <div class="bg-gray-800 p-6 rounded-2xl shadow-lg border border-gray-700">
      <h3 class="text-lg font-semibold text-blue-400 mb-4 flex items-center gap-2">
        <span class="material-symbols-outlined">notifications</span> Reminders
      </h3>
      <ul class="list-disc list-inside text-gray-300 space-y-2">
        {% for reminder in reminders %}
          <li>{{ reminder }}</li>
        {% else %}
          <li>No reminders</li>
        {% endfor %}
      </ul>
    </div>

    <!-- Quick Actions -->
    <div class="bg-gray-800 p-6 rounded-2xl shadow-lg border border-gray-700">
      <h3 class="text-lg font-semibold text-blue-400 mb-4 flex items-center gap-2">
        <span class="material-symbols-outlined">bolt</span> Quick Actions
      </h3>
      <div class="flex flex-col gap-3">
        <a href="{{ url_for('hr_admin.view_employees') }}" class="bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded text-center">Add Employee</a>
        <a href="{{ url_for('hr_admin.attendance_report') }}" class="bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded text-center">Generate Attendance Report</a>
        <a href="{{ url_for('hr_admin.leave_report') }}" class="bg-pink-600 hover:bg-pink-700 text-white py-2 px-4 rounded text-center">Generate Leave Report</a>
      </div>
    </div>

    <!-- Notes -->
    <div class="bg-gray-800 p-6 rounded-2xl shadow-lg border border-gray-700">
      <h3 class="text-lg font-semibold text-blue-400 mb-4 flex items-center gap-2">
        <span class="material-symbols-outlined">sticky_note_2</span> Notes
      </h3>
      <ul class="list-disc list-inside text-gray-300 space-y-2">
        {% for note in notes %}
          <li>{{ note }}</li>
        {% else %}
          <li>No notes</li>
        {% endfor %}
      </ul>
    </div>

  </div>

  <!-- Charts Section -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">

    <!-- Employee Growth -->
    <div class="bg-gray-800 p-6 rounded-2xl shadow-lg border border-gray-700">
      <h3 class="text-sm font-semibold text-blue-400 mb-4 flex items-center gap-2">
        <span class="material-symbols-outlined">trending_up</span> Employee Growth
      </h3>
      <div class="relative h-[240px]">
        <canvas id="employeeChart"></canvas>
      </div>
    </div>

    <!-- Department Distribution -->
    <div class="bg-gray-800 p-6 rounded-2xl shadow-lg border border-gray-700">
      <h3 class="text-sm font-semibold text-blue-400 mb-4 flex items-center gap-2">
        <span class="material-symbols-outlined">apartment</span> Department Distribution
      </h3>
      <div class="relative h-[240px]">
        <canvas id="deptChart"></canvas>
      </div>
    </div>
  </div>

  <!-- Additional Charts -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">

    <!-- Employees per Barangay -->
    <div class="bg-gray-800 p-6 rounded-2xl shadow-lg border border-gray-700">
      <h3 class="text-sm font-semibold text-blue-400 mb-4 flex items-center gap-2">
        <span class="material-symbols-outlined">location_city</span> Employees per Barangay
      </h3>
      <div class="relative h-[240px]">
        <canvas id="barangayChart"></canvas>
      </div>
    </div>

    <!-- Attendance Overview -->
    <div class="bg-gray-800 p-6 rounded-2xl shadow-lg border border-gray-700">
      <h3 class="text-sm font-semibold text-blue-400 mb-4 flex items-center gap-2">
        <span class="material-symbols-outlined">event_available</span> Attendance Overview
      </h3>
      <div class="relative h-[240px]">
        <canvas id="attendanceChart"></canvas>
      </div>
    </div>

    <!-- Leave Requests -->
    <div class="bg-gray-800 p-6 rounded-2xl shadow-lg border border-gray-700">
      <h3 class="text-sm font-semibold text-blue-400 mb-4 flex items-center gap-2">
        <span class="material-symbols-outlined">assignment</span> Leave Requests
      </h3>
      <div class="relative h-[240px]">
        <canvas id="leaveChart"></canvas>
      </div>
    </div>

  </div>

</section>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  function createLineChart(ctx, labels, data, color="#3b82f6", labelName="") {
    return new Chart(ctx, {
      type: "line",
      data: { labels, datasets: [{ label: labelName, data, borderColor: color, backgroundColor: color+"33", tension: 0.4, fill: true }]},
      options: {
        responsive: true,
        maintainAspectRatio: false,
        layout: { padding: 20 },
        plugins: { legend: { labels: { color: "#d1d5db" } } },
        scales: { x: { ticks: { color: "#9ca3af" } }, y: { ticks: { color: "#9ca3af" } } }
      }
    });
  }

  function createDoughnutChart(ctx, labels, data, colors) {
    return new Chart(ctx, {
      type: "doughnut",
      data: { labels, datasets: [{ data, backgroundColor: colors, borderWidth: 0 }]},
      options: {
        responsive: true,
        maintainAspectRatio: false,
        cutout: "68%",
        layout: { padding: 20 },
        plugins: { legend: { position: "bottom", labels: { color: "#d1d5db", padding: 14, boxWidth: 12 } } }
      }
    });
  }

  function createBarChart(ctx, labels, data, color="#3b82f6") {
    return new Chart(ctx, {
      type: "bar",
      data: { labels, datasets: [{ label: "Employees", data, backgroundColor: color }] },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        layout: { padding: 20 },
        plugins: { legend: { labels: { color: "#d1d5db" } } },
        scales: { x: { ticks: { color: "#9ca3af" } }, y: { ticks: { color: "#9ca3af" } } }
      }
    });
  }

  // Initialize charts
  createLineChart(document.getElementById("employeeChart"), {{ growth_labels|tojson }}, {{ growth_counts|tojson }}, "#3b82f6", "Employees");
  createDoughnutChart(document.getElementById("deptChart"), {{ dept_labels|tojson }}, {{ dept_counts|tojson }}, ["#3b82f6","#10b981","#facc15","#f87171","#a855f7"]);
  createBarChart(document.getElementById("barangayChart"), {{ barangay_labels|tojson }}, {{ barangay_counts|tojson }});
  createLineChart(document.getElementById("attendanceChart"), {{ attendance_labels|tojson }}, {{ attendance_counts|tojson }}, "#38bdf8", "Attendance %");
  createDoughnutChart(document.getElementById("leaveChart"), {{ leave_labels|tojson }}, {{ leave_counts|tojson }}, ["#10b981","#facc15","#ef4444"]);
</script>

{% endblock %}

{% extends 'hr/admin/admin_base.html' %}
{% block title %}Dashboard | HR Admin{% endblock %}
{% block content %}

<section>
  <h1 class="text-2xl font-semibold text-blue-400 mb-6 flex items-center gap-2">
    <span class="material-symbols-outlined text-3xl">dashboard</span>
    HR Dashboard
  </h1>

  <!-- Stats Overview -->
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
    <div class="bg-gray-800 p-6 rounded-2xl shadow-lg border border-gray-700 flex items-center gap-4">
      <div class="p-3 bg-blue-600 bg-opacity-20 rounded-full">
        <span class="material-symbols-outlined text-blue-400 text-3xl">groups</span>
      </div>
      <div>
        <p class="text-gray-400">Total Employees</p>
        <h2 class="text-3xl font-bold text-blue-400 mt-2">{{ total_employees }}</h2>
      </div>
    </div>

    <div class="bg-gray-800 p-6 rounded-2xl shadow-lg border border-gray-700 flex items-center gap-4">
      <div class="p-3 bg-emerald-600 bg-opacity-20 rounded-full">
        <span class="material-symbols-outlined text-emerald-400 text-3xl">person</span>
      </div>
      <div>
        <p class="text-gray-400">Active Employees</p>
        <h2 class="text-3xl font-bold text-emerald-400 mt-2">{{ active_employees }}</h2>
      </div>
    </div>

    <div class="bg-gray-800 p-6 rounded-2xl shadow-lg border border-gray-700 flex items-center gap-4">
      <div class="p-3 bg-yellow-400 bg-opacity-20 rounded-full">
        <span class="material-symbols-outlined text-yellow-400 text-3xl">apartment</span>
      </div>
      <div>
        <p class="text-gray-400">Total Departments</p>
        <h2 class="text-3xl font-bold text-yellow-400 mt-2">{{ total_departments }}</h2>
      </div>
    </div>

    <div class="bg-gray-800 p-6 rounded-2xl shadow-lg border border-gray-700 flex items-center gap-4">
      <div class="p-3 bg-pink-400 bg-opacity-20 rounded-full">
        <span class="material-symbols-outlined text-pink-400 text-3xl">event_available</span>
      </div>
      <div>
        <p class="text-gray-400">Monthly Attendance</p>
        <h2 class="text-3xl font-bold text-pink-400 mt-2">
          {% if attendance_counts|length > 0 %}
            {{ (attendance_counts|sum / attendance_counts|length)|round(2) }}%
          {% else %}
            0%
          {% endif %}
        </h2>
      </div>
    </div>
  </div>

  <!-- Graphs Section -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
    <!-- Employee Growth -->
    <div class="bg-gray-800 p-6 rounded-2xl shadow-lg border border-gray-700">
      <h2 class="text-lg font-semibold text-blue-400 mb-4 flex items-center gap-2">
        <span class="material-symbols-outlined">trending_up</span> Employee Growth
      </h2>
      <canvas id="employeeChart" height="120"></canvas>
    </div>

    <!-- Department Distribution -->
    <div class="bg-gray-800 p-6 rounded-2xl shadow-lg border border-gray-700">
      <h2 class="text-lg font-semibold text-blue-400 mb-4 flex items-center gap-2">
        <span class="material-symbols-outlined">apartment</span> Department Distribution
      </h2>
      <canvas id="deptChart" height="120"></canvas>
    </div>
  </div>

  <!-- Additional Graphs -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- Employees per Barangay -->
    <div class="bg-gray-800 p-6 rounded-2xl shadow-lg border border-gray-700">
      <h2 class="text-lg font-semibold text-blue-400 mb-4 flex items-center gap-2">
        <span class="material-symbols-outlined">location_city</span> Employees per Barangay
      </h2>
      <canvas id="barangayChart" height="120"></canvas>
    </div>

    <!-- Attendance Overview -->
    <div class="bg-gray-800 p-6 rounded-2xl shadow-lg border border-gray-700">
      <h2 class="text-lg font-semibold text-blue-400 mb-4 flex items-center gap-2">
        <span class="material-symbols-outlined">event_available</span> Attendance Overview
      </h2>
      <canvas id="attendanceChart" height="120"></canvas>
    </div>

    <!-- Leave Requests -->
    <div class="bg-gray-800 p-6 rounded-2xl shadow-lg border border-gray-700">
      <h2 class="text-lg font-semibold text-blue-400 mb-4 flex items-center gap-2">
        <span class="material-symbols-outlined">assignment</span> Leave Requests
      </h2>
      <canvas id="leaveChart" height="120"></canvas>
    </div>
  </div>
</section>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // Employee Growth (Line)
  const ctx1 = document.getElementById("employeeChart").getContext("2d");
  new Chart(ctx1, {
    type: "line",
    data: {
      labels: {{ growth_labels|tojson }},
      datasets: [{
        label: "Employees",
        data: {{ growth_counts|tojson }},
        borderColor: "#60a5fa",
        backgroundColor: "rgba(59,130,246,0.2)",
        tension: 0.3,
        fill: true,
      }],
    },
    options: {
      scales: {
        x: { ticks: { color: "#9ca3af" } },
        y: { ticks: { color: "#9ca3af" } },
      },
      plugins: { legend: { labels: { color: "#d1d5db" } } },
    },
  });

  // Department Distribution (Doughnut)
  const ctx2 = document.getElementById("deptChart").getContext("2d");
  new Chart(ctx2, {
    type: "doughnut",
    data: {
      labels: {{ dept_labels|tojson }},
      datasets: [{
        data: {{ dept_counts|tojson }},
        backgroundColor: ["#3b82f6", "#10b981", "#facc15", "#f87171", "#a855f7"],
        borderWidth: 0,
      }],
    },
    options: {
      plugins: { legend: { labels: { color: "#d1d5db" } } },
    },
  });

  // Employees per Barangay (Bar)
  const ctx3 = document.getElementById("barangayChart").getContext("2d");
  new Chart(ctx3, {
    type: "bar",
    data: {
      labels: {{ barangay_labels|tojson }},
      datasets: [{
        label: "Employees",
        data: {{ barangay_counts|tojson }},
        backgroundColor: ["#3b82f6", "#10b981", "#f43f5e", "#f59e0b", "#8b5cf6"],
      }],
    },
    options: {
      scales: {
        x: { ticks: { color: "#9ca3af" } },
        y: { ticks: { color: "#9ca3af" } },
      },
      plugins: { legend: { labels: { color: "#d1d5db" } } },
    },
  });

  // Attendance Overview (Line)
  const ctx4 = document.getElementById("attendanceChart").getContext("2d");
  new Chart(ctx4, {
    type: "line",
    data: {
      labels: {{ attendance_labels|tojson }},
      datasets: [{
        label: "Attendance %",
        data: {{ attendance_counts|tojson }},
        borderColor: "#38bdf8",
        backgroundColor: "rgba(56,189,248,0.3)",
        tension: 0.4,
        fill: true,
      }],
    },
    options: {
      scales: {
        x: { ticks: { color: "#9ca3af" } },
        y: { ticks: { color: "#9ca3af" } },
      },
      plugins: { legend: { labels: { color: "#d1d5db" } } },
    },
  });

  // Leave Requests (Pie)
  const ctx5 = document.getElementById("leaveChart").getContext("2d");
  new Chart(ctx5, {
    type: "pie",
    data: {
      labels: {{ leave_labels|tojson }},
      datasets: [{
        data: {{ leave_counts|tojson }},
        backgroundColor: ["#10b981", "#facc15", "#ef4444"],
        borderWidth: 0,
      }],
    },
    options: {
      plugins: { legend: { labels: { color: "#d1d5db" } } },
    },
  });
</script>

{% endblock %}

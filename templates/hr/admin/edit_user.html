{% extends 'hr/admin/admin_base.html' %}
{% block title %}Edit User{% endblock %}

{% block content %}
<main class="content-wrap">
  <header class="content-head">
    <h1><b>Edit User</b></h1>
    <!-- Styled back button -->
  </header>
  
  <center>
    <div class="edit-container">
      <header>User Details</header>
      <form id="editUserForm" method="POST" action="{{ url_for('hr_admin.edit_user', user_id=user.id) }}">
        <div class="form first">
          <div class="details personal">
            <div class="fields">

              <div class="input-field">
                <label>Email</label>
                <input type="email" name="email" value="{{ user.email }}" readonly />
              </div>

              <div class="input-field">
                <label>First Name</label>
                <input type="text" name="first_name" value="{{ user.first_name }}" readonly/>
              </div>

              <div class="input-field">
                <label>Last Name</label>
                <input type="text" name="last_name" value="{{ user.last_name }}" readonly />
              </div>

              <div class="input-field">
                <label>Role</label>
                <select name="role" required>
                  <option disabled>Select Role</option>
                  <option value="admin" {% if user.role == 'admin' %}selected{% endif %}>Admin</option>
                  <option value="officer" {% if user.role == 'officer' %}selected{% endif %}>Officer</option>
                  <option value="dept_head" {% if user.role == 'dept_head' %}selected{% endif %}>Department Head</option>
                  <option value="employee" {% if user.role == 'employee' %}selected{% endif %}>Employee</option>
                </select>
              </div>

              <div class="input-field">
                <label>Status</label>
                <select name="status" required>
                  <option disabled>Select Status</option>
                  <option value="1" {% if user.active %}selected{% endif %}>Active</option>
                  <option value="0" {% if not user.active %}selected{% endif %}>Inactive</option>
                </select>
              </div>

            </div>
          </div>

          <div class="buttons">
            <button type="submit" style="color: #fff;" class="printing">Update User
            </button>
            <a href="{{ url_for('hr_admin.view_users') }}" class="printing" style="margin-top:8px; color: #fff; text-decoration: none;">
              <i class="uil uil-navigator"></i>
              <span class="btnText">Back to Users</span>
            </a>

          </div>
        </div>
      </form>
    </div>
  </center>
</main>

<!-- SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
document.addEventListener("DOMContentLoaded", function () {
  const form = document.getElementById("editUserForm");

  form.addEventListener("submit", function (e) {
    e.preventDefault();

    Swal.fire({
      title: 'Are you sure?',
      text: "You are about to update this user's details!",
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#3085d6',
      cancelButtonColor: '#d33',
      confirmButtonText: 'Yes, update it!'
    }).then((result) => {
      if (result.isConfirmed) {
        const formData = new FormData(form);
        fetch(form.action, {
          method: 'POST',
          body: formData,
          headers: { 'X-Requested-With': 'XMLHttpRequest' }
        })
        .then(res => res.json())
        .then(data => {
          if (data.success) {
            Swal.fire({
              icon: 'success',
              title: 'Updated!',
              text: 'User details have been updated.',
              timer: 2000,
              showConfirmButton: false
            }).then(() => {
              window.location.href = "{{ url_for('hr_admin.view_users') }}";
            });
          } else {
            Swal.fire({
              icon: 'error',
              title: 'Error!',
              text: data.message || 'Something went wrong.'
            });
          }
        })
        .catch(err => {
          Swal.fire({
            icon: 'error',
            title: 'Error!',
            text: 'Something went wrong.'
          });
        });
      }
    });
  });
});
</script>
{% endblock %}

{% extends 'hr/admin/admin_base.html' %}
{% block title %}Edit Position{% endblock %}

{% block content %}
<main class="content-wrap">
  <header class="content-head">
    <h1><b>Edit Position Details</b></h1>
  </header>

  <div class="edit-container">
    <form id="editPositionForm" method="POST" action="{{ url_for('hr_admin.edit_position', position_id=position.id) }}">
      {{ form.hidden_tag() if form else '' }}
      
      <div class="form first">
        <div class="details personal">
          <div class="fields">
            <!-- Position Name -->
            <div class="input-field">
              <label>Position Name</label>
              <input 
                type="text" 
                name="name" 
                value="{{ position.name }}" 
                placeholder="Enter position name"
                required
              />
            </div>

            <!-- Description -->
            <div class="input-field">
              <label>Description</label>
              <textarea 
                name="description" 
                placeholder="Enter position description" 
                rows="4"
                style="resize: none;"
              >{{ position.description }}</textarea>
            </div>
          </div>
        </div>

        <!-- Buttons -->
        <div style="margin-top: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
          <!-- Update Button -->
          <button type="submit" style="color: #fff;" class="printing">
            <span class="material-symbols-outlined">update</span>
            Update Position
          </button>

          <!-- Back Button -->
          <a href="{{ url_for('hr_admin.view_positions') }}" style="background: #FF6347;" class="printing">
            <span class="material-symbols-outlined">cancel</span>
            Cancel
          </a>
        </div>
      </div>
    </form>
  </div>
</main>

<!-- SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
document.getElementById("editPositionForm").addEventListener("submit", function(e){
    e.preventDefault(); 

    Swal.fire({
        title: 'Are you sure?',
        text: "Do you want to update this position?",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Yes, update!'
    }).then((result) => {
        if (result.isConfirmed) {
            const formData = new FormData(this);
            fetch(this.action, {
                method: 'POST',
                body: formData,
                headers: { 'X-Requested-With': 'XMLHttpRequest' }
            })
            .then(res => res.json())
            .then(data => {
                if(data.status === "success"){
                    Swal.fire('Updated!', data.message, 'success').then(() => {
                        window.location.href = "{{ url_for('hr_admin.view_positions') }}";
                    });
                } else {
                    Swal.fire('Error!', data.message, 'error');
                }
            })
            .catch(() => {
                Swal.fire('Error!', 'Something went wrong.', 'error');
            });
        }
    });
});
</script>
{% endblock %}

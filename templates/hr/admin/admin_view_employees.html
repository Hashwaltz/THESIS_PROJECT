{% extends 'hr/admin/admin_base.html' %} 
{% block title %}HR Admin - Employees{% endblock %} 

{% block content %}
<main class="content-wrap">
  <header class="content-head">
    <h1><b>Employee Records</b></h1>
  </header>

  <!-- Employee Search + Filter -->
  <div class="search-container">
    <form
      method="get"
      action="{{ url_for('hr_admin.view_employees') }}"
      id="employeeFilterForm"
    >
    <div class="filter-row">
      <div class="input-field">
        <select name="department_id" id="departmentSelect">
          <option value="">All Departments</option>
          {% for dept in departments %}
          <option value="{{ dept.id }}" {% if dept.id|string == selected_department %}selected{% endif %}>
            {{ dept.name }}
          </option>
          {% endfor %}
        </select>
      </div>

      <div class="input-field">
        <select name="employment_type_id" id="employmentTypeSelect">
          <option value="">All Employment Types</option>
          {% for etype in employment_types %}
          <option value="{{ etype.id }}" {% if etype.id|string == selected_employment_type %}selected{% endif %}>
            {{ etype.name }}
          </option>
          {% endfor %}
        </select>
      </div>
     </div> 

      <div class="input-field">
        <input
          type="text"
          name="search"
          value="{{ search }}"
          placeholder="Search employees..."
        />
      </div>

      <button type="submit">
        <span class="material-symbols-outlined">person_search</span>
        Search
      </button>
    </form>
  </div>

  <!-- Employee Table -->
  <div class="table-container">
    <div class="centered-container">
      <!-- Buttons aligned to right -->
      <div style="display: flex; justify-content: flex-end; gap: 10px; margin-bottom: 10px;">
        <a
          href="{{ url_for('hr_admin.add_employee') }}"
          style="display: flex; align-items: center; gap: 6px; text-decoration: none; background: #28a745; color: white; padding: 6px 12px; border-radius: 5px;"
        >
          <span class="material-symbols-outlined" style="font-size: 30px">person_add</span>
          Add Employee
        </a>

        <a
          href="{{ url_for('hr_admin.export_employees_excel') }}"
          style="display: flex; align-items: center; gap: 6px; text-decoration: none; background: #007bff; color: white; padding: 6px 12px; border-radius: 5px;"
        >
          <span class="material-symbols-outlined">
          download
          </span>
          Export Employees (Excel)
        </a>
      </div>

      <table class="responsive-table">
        <caption>
          <b>Employee List</b>
        </caption>
        <thead>
          <tr>
            <th>ID</th>
            <th>Full Name</th>
            <th>Email</th>
            <th>Phone</th>
            <th>Department</th>
            <th>Position</th>
            <th>Date Hired</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for employee in employees.items %}
          <tr>
            <td data-label="Employee ID">{{ employee.id }}</td>
            <td data-label="Full Name">{{ employee.get_full_name() }}</td>
            <td data-label="Email">{{ employee.email }}</td>
            <td data-label="Phone">{{ employee.phone or '-' }}</td>
            <td data-label="Department">
              {{ employee.department.name if employee.department else '-' }}
            </td>
            <td data-label="Position">
              {{ employee.position.name if employee.position else '-' }}
            </td>
            <td data-label="Date Hired">
              {{ employee.updated_at.strftime('%Y-%m-%d') if employee.updated_at else '-' }}
            </td>
            <td data-label="Status">
              <span style="color: {{ 'green' if employee.active else 'red' }};">
                {{ 'Active' if employee.active else 'Inactive' }}
              </span>
            </td>
            <td data-label="Actions">
              <a
                href="{{ url_for('hr_admin.edit_employee', employee_id=employee.id) }}"
                class="btn-action"
              >
                Edit
              </a>
            </td>
          </tr>
          {% else %}
          <tr>
            <td colspan="9">No employees found.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

      <!-- Pagination -->
      <div class="pagination" style="margin-top: 1rem; text-align: center">
        {% if employees.has_prev %}
        <a
          href="{{ url_for('hr_admin.view_employees', page=employees.prev_num, search=search, department_id=selected_department, employment_type_id=selected_employment_type) }}"
        >
          Previous
        </a>
        {% endif %}

        Page {{ employees.page }} of {{ employees.pages }}

        {% if employees.has_next %}
        <a
          href="{{ url_for('hr_admin.view_employees', page=employees.next_num, search=search, department_id=selected_department, employment_type_id=selected_employment_type) }}"
        >
          Next
        </a>
        {% endif %}
      </div>
    </div>
  </div>
</main>

<!-- Auto Filter Script -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const filterForm = document.getElementById("employeeFilterForm");
    const departmentSelect = document.getElementById("departmentSelect");
    const employmentTypeSelect = document.getElementById("employmentTypeSelect");

    // Auto-submit when Department changes
    departmentSelect.addEventListener("change", () => {
      filterForm.submit();
    });

    // Auto-submit when Employment Type changes
    employmentTypeSelect.addEventListener("change", () => {
      filterForm.submit();
    });
  });
</script>

{% endblock %}

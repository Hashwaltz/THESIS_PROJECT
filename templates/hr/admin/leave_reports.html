{% extends 'hr/admin/admin_base.html' %}
{% block title %}HR Admin - Leave Reports{% endblock %}

{% block content %}
<main class="content-wrap">
  <header class="content-head">
    <h1><b>Leave Reports</b></h1>
  </header>

  <!-- ðŸ”¹ Filter Form -->
  <div class="search-container">
    <form method="get">
        <div class="input-field">
          <label>Start Date:</label>
          <input type="date" name="start_date" value="{{ start_date }}">
        </div>

        <div class="input-field">
          <label>End Date:</label>
          <input type="date" name="end_date" value="{{ end_date }}">
        </div>

        <div class="input-field">
          <select name="department_id">
            <option value="">All Departments</option>
            {% for dept in departments %}
              <option value="{{ dept.id }}" {% if selected_dept == dept.id %}selected{% endif %}>
                {{ dept.name }}
              </option>
            {% endfor %}
          </select>
        </div>

        <div class="input-field">
          <select name="leave_type_id">
            <option value="">All Leave Types</option>
            {% for lt in leave_types %}
              <option value="{{ lt.id }}" {% if selected_leave_type == lt.id %}selected{% endif %}>
                {{ lt.name }}
              </option>
            {% endfor %}
          </select>
        </div>

      <!-- ðŸ”¹ Action Buttons -->
      <div class="input-field">
        <button type="submit">
          <span class="material-symbols-outlined">
          text_fields_alt
          </span>
          Generate
        </button>
        <a href="{{ url_for('hr_admin.leave_report_word', 
                    start_date=start_date, 
                    end_date=end_date, 
                    department_id=selected_dept, 
                    leave_type_id=selected_leave_type) }}"
            style="margin-bottom: 15px; display: flex; align-items: center; gap: 6px; text-decoration: none; background: #007bff; color: white; padding: 6px 12px; border-radius: 5px;">
            <span class="material-symbols-outlined">download</span>
            Export Leave Report (.docx)
        </a>

      </div>
    </form>
  </section>

  <!-- ðŸ”¹ Report Results Table -->
  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>Employee</th>
          <th>Department</th>
          <th>Total Leave Days</th>
          <th>No. of Leaves</th>
        </tr>
      </thead>
      <tbody>
        {% if results %}
          {% for row in results %}
            <tr>
              <td data-label="Employee">{{ row.employee_name }}</td>
              <td data-label="Department">{{ row.department_name }}</td>
              <td data-label="Total Leave Days">{{ row.total_leave_days or 0 }}</td>
              <td data-label="No. of Leaves">{{ row.leave_count or 0 }}</td>
            </tr>
          {% endfor %}
        {% else %}
          <tr>
            <td colspan="4" style="text-align:center;">No leave records found.</td>
          </tr>
        {% endif %}
      </tbody>
    </table>
  </div>
</main>
{% endblock %}

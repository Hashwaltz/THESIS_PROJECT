{% extends 'hr/head/head_base.html' %}
{% block title %}Department Head - Dashboard{% endblock %}
{% block content %}

{% if not_assigned %}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
Swal.fire({
    icon: 'info',
    title: 'Access Denied',
    text: 'You are not assigned as a department head yet. Please wait for the admins to assign you.',
    confirmButtonText: 'OK'
}).then((result) => {
    if (result.isConfirmed) {
        window.location.href = "{{ url_for('hr_auth.logout') }}";
    }
});
</script>
{% endif %}

<div class="p-6 space-y-8">
  <!-- Header -->
  <header>
    <h1 class="text-2xl font-bold text-gray-800">{{ current_user.department.name }} Department Head Dashboard</h1>
  </header>

  <!-- Info Boxes -->
  <section class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-6">

    <!-- Employees -->
    <div class="bg-white shadow-md rounded-xl p-5 flex items-center gap-4 border hover:shadow-lg transition">
      <span class="material-symbols-outlined text-gray-600 text-5xl">group</span>
      <div>
        <p class="text-3xl font-bold">{{ total_employees }}</p>
        <p class="text-gray-600 text-sm">Employees<br>{{ current_user.department.name }}</p>
      </div>
    </div>

    <!-- Recent Leaves -->
    <div class="bg-white shadow-md rounded-xl p-5 flex items-center gap-4 border hover:shadow-lg transition">
      <span class="material-symbols-outlined text-gray-600 text-5xl">assignment_add</span>
      <div>
        <p class="text-3xl font-bold">{{ recent_leaves|length }}</p>
        <p class="text-gray-600 text-sm">Recent Leave Requests</p>
      </div>
    </div>

    <!-- Present -->
    <div class="bg-white shadow-md rounded-xl p-5 flex items-center gap-4 border hover:shadow-lg transition">
      <span class="material-symbols-outlined text-gray-600 text-5xl">check_circle</span>
      <div>
        <p class="text-3xl font-bold">{{ attendance_summary.total_present }}</p>
        <p class="text-gray-600 text-sm">Present (This Month)</p>
      </div>
    </div>

    <!-- Absent -->
    <div class="bg-white shadow-md rounded-xl p-5 flex items-center gap-4 border hover:shadow-lg transition">
      <span class="material-symbols-outlined text-gray-600 text-5xl">cancel</span>
      <div>
        <p class="text-3xl font-bold">{{ attendance_summary.total_absent }}</p>
        <p class="text-gray-600 text-sm">Absent (This Month)</p>
      </div>
    </div>

    <!-- Late -->
    <div class="bg-white shadow-md rounded-xl p-5 flex items-center gap-4 border hover:shadow-lg transition">
      <span class="material-symbols-outlined text-gray-600 text-5xl">schedule</span>
      <div>
        <p class="text-3xl font-bold">{{ attendance_summary.total_late }}</p>
        <p class="text-gray-600 text-sm">Late (This Month)</p>
      </div>
    </div>

  </section>

  <!-- Chart Section -->
  <section class="mt-10">
    <div class="bg-white p-6 rounded-xl shadow-md border">
      <h2 class="text-lg font-semibold mb-4 text-gray-700">Monthly Attendance Overview</h2>
      <div class="h-96">
        <canvas id="monthlyAttendanceChart"></canvas>
      </div>
    </div>
  </section>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  const monthlyDates = {{ attendance_chart.dates | tojson }};
  const monthlyPresentCounts = {{ attendance_chart.present_counts | tojson }};
  const monthlyAbsentCounts = {{ attendance_chart.absent_counts | tojson }};
  const monthlyLateCounts = {{ attendance_chart.late_counts | tojson }};


  const ctx = document.getElementById('monthlyAttendanceChart').getContext('2d');
  new Chart(ctx, {
    type: 'line',
    data: {
      labels: monthlyDates,
      datasets: [
        {
          label: 'Present',
          data: monthlyPresentCounts,
          borderColor: '#4ade80',
          backgroundColor: 'rgba(74, 222, 128, 0.3)',
          fill: true,
          tension: 0.3,
          borderWidth: 2
        },
        {
          label: 'Absent',
          data: monthlyAbsentCounts,
          borderColor: '#f87171',
          backgroundColor: 'rgba(248, 113, 113, 0.3)',
          fill: true,
          tension: 0.3,
          borderWidth: 2
        },
        {
          label: 'Late',
          data: monthlyLateCounts,
          borderColor: '#fbbf24',
          backgroundColor: 'rgba(251, 191, 36, 0.3)',
          fill: true,
          tension: 0.3,
          borderWidth: 2
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { position: 'bottom' }
      },
      scales: {
        x: { title: { display: true, text: 'Date' } },
        y: { beginAtZero: true, title: { display: true, text: 'Count' } }
      }
    }
  });
});
</script>

{% endblock %}

{% extends "hr/employee/employee_base.html" %}
{% block title %}Employee - Change Password{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto mt-10 p-6 bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 rounded-2xl shadow-lg text-slate-100">
  <h1 class="text-2xl font-semibold text-white mb-6 flex items-center gap-2">
    <span class="material-symbols-outlined text-3xl">lock</span>
    Change Password
  </h1>

  <form id="changePasswordForm" class="space-y-6">
    <div>
      <label class="block text-slate-300 text-sm mb-1">Current Password</label>
      <input type="password" name="current_password" required
        class="w-full px-4 py-2 rounded-xl bg-slate-800 border border-slate-600 text-white focus:ring-2 focus:ring-blue-500" 
        placeholder="Enter current password">
    </div>

    <div>
      <label class="block text-slate-300 text-sm mb-1">New Password</label>
      <input type="password" name="new_password" required
        class="w-full px-4 py-2 rounded-xl bg-slate-800 border border-slate-600 text-white focus:ring-2 focus:ring-blue-500"
        placeholder="Enter new password">
    </div>

    <div>
      <label class="block text-slate-300 text-sm mb-1">Confirm New Password</label>
      <input type="password" name="confirm_password" required
        class="w-full px-4 py-2 rounded-xl bg-slate-800 border border-slate-600 text-white focus:ring-2 focus:ring-blue-500"
        placeholder="Confirm new password">
    </div>

    <button type="submit"
      class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold px-4 py-3 rounded-xl shadow-md transition">
      Update Password
    </button>
  </form>
</div>

<!-- SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
document.getElementById("changePasswordForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const formData = new FormData(e.target);
  const data = Object.fromEntries(formData.entries());

  if (data.new_password !== data.confirm_password) {
    return Swal.fire({
      icon: 'error',
      title: 'Mismatch',
      text: 'New password and confirm password do not match.',
      confirmButtonColor: '#2563EB'
    });
  }

  const confirm = await Swal.fire({
    title: 'Confirm Change',
    text: 'Are you sure you want to change your password?',
    icon: 'question',
    showCancelButton: true,
    confirmButtonColor: '#2563EB',
    cancelButtonColor: '#6B7280',
    confirmButtonText: 'Yes, change it!'
  });

  if (!confirm.isConfirmed) return;

  try {
    const response = await fetch('{{ url_for("employee.edit_password") }}', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify(data)
    });

    const res = await response.json();
    if (res.status === 'success') {
      Swal.fire('Success!', res.message, 'success').then(() => location.reload());
    } else {
      Swal.fire('Error', res.message, 'error');
    }
  } catch (err) {
    Swal.fire('Error', 'Something went wrong. Please try again.', 'error');
  }
});
</script>
{% endblock %}

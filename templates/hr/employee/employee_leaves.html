{% extends 'hr/employee/employee_base.html' %}
{% block title %}Employee - Leave Records{% endblock %}

{% block content %}
<main class="content-wrap">
  <header class="content-head" style="display: flex; justify-content: space-between; align-items: center;">
    <div>
      <h1>Leave Records</h1>
      <p>
        <b>Leave Balances:</b>
        {% for lt, bal in leave_balances.items() %}
          {{ lt }}: {{ bal }} |
        {% endfor %}
      </p>
    </div>
    <!-- Request Leave Button -->
    <div>
      <a href="{{ url_for('employee.request_leave') }}" class="btn btn-primary" style="padding: 6px 12px; background-color:#4CAF50; color:white; border-radius:4px; text-decoration:none;">
        <i class="fa fa-plus"></i> Request Leave
      </a>
    </div>
  </header>

  <!-- Filter by Status -->
  <div class="search-box">
    <form method="get" id="filterForm">
      <div class="fields">
        <div class="input-field">
          <label>Status</label>
          <select name="status" id="statusFilter">
            <option value="" {% if not status_filter %}selected{% endif %}>All</option>
            <option value="Pending" {% if status_filter=='Pending' %}selected{% endif %}>Pending</option>
            <option value="Approved" {% if status_filter=='Approved' %}selected{% endif %}>Approved</option>
            <option value="Rejected" {% if status_filter=='Rejected' %}selected{% endif %}>Rejected</option>
          </select>
        </div>
      </div>
    </form>
  </div>

  <!-- Leave Table -->
  <div class="table-container">
    <table class="responsive-table">
      <caption><b>Leave List</b></caption>
      <thead>
        <tr>
          <th>Type</th>
          <th>Start Date</th>
          <th>End Date</th>
          <th>Days</th>
          <th>Status</th>
          <th>Reason</th>
        </tr>
      </thead>
      <tbody>
        {% for leave in leaves.items %}
        <tr>
          <td data-label="Type">{{ leave.leave_type.name }}</td>
          <td data-label="Start Date">{{ leave.start_date.strftime('%Y-%m-%d') }}</td>
          <td data-label="End Date">{{ leave.end_date.strftime('%Y-%m-%d') }}</td>
          <td data-label="Days">{{ leave.days_requested }}</td>
          <td data-label="Status" style="color:
              {% if leave.status == 'Approved' %}green
              {% elif leave.status == 'Pending' %}orange
              {% else %}red{% endif %};">
            {{ leave.status }}
          </td>
          <td data-label="Reason">{{ leave.reason }}</td>
        </tr>
        {% else %}
        <tr>
          <td colspan="6">No leave records found.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <!-- Pagination -->
    <div class="pagination">
      {% if leaves.has_prev %}
        <a href="{{ url_for('employee.leaves', page=leaves.prev_num, status=status_filter) }}">Previous</a>
      {% endif %}

      Page {{ leaves.page }} of {{ leaves.pages }}

      {% if leaves.has_next %}
        <a href="{{ url_for('employee.leaves', page=leaves.next_num, status=status_filter) }}">Next</a>
      {% endif %}
    </div>
  </div>
</main>

<!-- Auto-submit JS for status filter -->
<script>
  document.getElementById('statusFilter').addEventListener('change', function() {
      document.getElementById('filterForm').submit();
  });
</script>
{% endblock %}

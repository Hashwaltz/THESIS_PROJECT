{% extends 'hr/officer/officer_base.html' %}
{% block title %}HR Officer - Edit Attendance{% endblock %}

{% block content %}
<main class="content-wrap">
  <center>
    <div class="edit-container">
      <header><b>Edit Attendance Record</b></header>

      <form id="editAttendanceForm" method="POST" action="{{ url_for('officer.edit_attendance', attendance_id=attendance.id) }}">
        <div class="form first">
          <div class="details personal">
            <div class="fields">

              <div class="input-field">
                <label>Employee</label>
                <select name="employee_id" required>
                  {% for e in form.employee_id.choices %}
                    <option value="{{ e[0] }}" {% if e[0] == attendance.employee_id %}selected{% endif %}>
                      {{ e[1] }}
                    </option>
                  {% endfor %}
                </select>
              </div>

              <div class="input-field">
                <label>Date</label>
                <input type="date" name="date" value="{{ attendance.date.strftime('%Y-%m-%d') }}" required />
              </div>

              <div class="input-field">
                <label>Time In</label>
                <input type="time" name="time_in" value="{{ attendance.time_in.strftime('%H:%M') if attendance.time_in else '' }}" required />
              </div>

              <div class="input-field">
                <label>Time Out</label>
                <input type="time" name="time_out" value="{{ attendance.time_out.strftime('%H:%M') if attendance.time_out else '' }}" required />
              </div>

              <div class="input-field">
                <label>Status</label>
                <select name="status" required>
                  <option value="Present" {% if attendance.status == 'Present' %}selected{% endif %}>Present</option>
                  <option value="Absent" {% if attendance.status == 'Absent' %}selected{% endif %}>Absent</option>
                  <option value="Leave" {% if attendance.status == 'Leave' %}selected{% endif %}>Leave</option>
                  <option value="Late" {% if attendance.status == 'Late' %}selected{% endif %}>Late</option>
                </select>
              </div>

              <div class="input-field">
                <label>Remarks</label>
                <input type="text" name="remarks" value="{{ attendance.remarks }}" />
              </div>

            </div>
          </div>

          <button type="submit" class="printing">
            <span style="color: #fff;" class="btnText">Update Attendance</span>
            <i class="uil uil-navigator"></i>
          </button>
        </div>
      </form>
    </div>
  </center>
</main>

<!-- SweetAlert CDN -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
document.getElementById('editAttendanceForm').addEventListener('submit', async function(e) {
  e.preventDefault();
  const form = e.target;

  const confirm = await Swal.fire({
    title: 'Confirm Update',
    text: 'Are you sure you want to save changes?',
    icon: 'question',
    showCancelButton: true,
    confirmButtonText: 'Yes, update it!',
    cancelButtonText: 'Cancel',
    confirmButtonColor: '#3085d6',
    cancelButtonColor: '#d33'
  });

  if (!confirm.isConfirmed) return;

  const response = await fetch(form.action, {
    method: 'POST',
    body: new FormData(form),
  });

  const result = await response.json();

  if (result.status === 'success') {
    Swal.fire({
      icon: 'success',
      title: 'Updated!',
      text: result.message,
      showConfirmButton: false,
      timer: 2000
    }).then(() => {
      window.location.href = "{{ url_for('officer.attendance') }}";
    });
  } else {
    Swal.fire({
      icon: 'error',
      title: 'Error',
      text: result.message
    });
  }
});
</script>
{% endblock %}

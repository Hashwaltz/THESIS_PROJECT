{# templates/hr/officer/officer_dashboard.html #}
{% extends 'hr/officer/officer_base.html' %} 
{% block title %}HR Officer - Dashboard {% endblock %} 

{% block content%}
<main class="content-wrap">
  <header class="content-head">
    <h1><b>Officer Dashboard</b></h1>
  </header>

  <div class="content">
    <section class="info-boxes">
      <div class="info-box">
        <div class="box-icon">
           <span class="material-symbols-outlined" style="font-size: 50px; color:#4a5568; font-weight: 400;">
            check_circle
          </span>
        </div>
        <div class="box-content">
          <span class="big">{{present_count}}</span>
          Present Today
        </div>
      </div>

      <div class="info-box">
        <div class="box-icon">
           <span class="material-symbols-outlined" style="font-size: 50px; color:#4a5568; font-weight: 400;">
            cancel
          </span>
        </div>
        <div class="box-content">
          <span class="big">{{ absent_count }}</span>
          Absent Today
        </div>
      </div>

      <div class="info-box">
        <div class="box-icon">
           <span class="material-symbols-outlined" style="font-size: 50px; color:#4a5568; font-weight: 400;">
            group
          </span>
        </div>
        <div class="box-content">
          <span class="big">{{ total_users }}</span>
          Total Employees
        </div>
      </div>
    </section>
  </div>

  <div class="chart-container">a
    <canvas id="monthlyAttendanceChart"></canvas> {# Changed ID to avoid conflict #}
  </div>
  
  <div class="reminders-section">
    <h2>Daily Reminders</h2>
    {% if reminders %}
    <ul>
      {% for reminder in reminders %}
      <li>{{ reminder }}</li>
      {% endfor %}
    </ul>
    {% else %}
    <p class="text-center">No reminders for today!</p>
    {% endif %}
  </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script> {# Ensure Chart.js is loaded #}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Data from Flask context for the monthly graph
    const monthlyDates = {{ monthly_dates | tojson }};
    const monthlyPresentCounts = {{ monthly_present_counts | tojson }};
    const monthlyAbsentCounts = {{ monthly_absent_counts | tojson }};
    const monthlyLateCounts = {{ monthly_late_counts | tojson }};

    const ctx = document.getElementById('monthlyAttendanceChart').getContext('2d');
    const monthlyAttendanceChart = new Chart(ctx, {
      type: 'line', // 'line' chart is often better for time series
      data: {
        labels: monthlyDates,
        datasets: [
          {
            label: 'Present',
            data: monthlyPresentCounts,
            backgroundColor: 'rgba(75, 192, 192, 0.4)', // Light green
            borderColor: 'rgba(75, 192, 192, 1)',
            borderWidth: 2,
            tension: 0.3, // Smoother lines
            fill: true
          },
          {
            label: 'Absent',
            data: monthlyAbsentCounts,
            backgroundColor: 'rgba(255, 99, 132, 0.4)',  // Light red
            borderColor: 'rgba(255, 99, 132, 1)',
            borderWidth: 2,
            tension: 0.3,
            fill: true
          },
          {
            label: 'Late',
            data: monthlyLateCounts,
            backgroundColor: 'rgba(255, 206, 86, 0.4)', // Light yellow/orange
            borderColor: 'rgba(255, 206, 86, 1)',
            borderWidth: 2,
            tension: 0.3,
            fill: true
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          x: {
            title: {
              display: true,
              text: 'Date of Month'
            }
          },
          y: {
            beginAtZero: true,
            title: {
              display: true,
              text: 'Number of Employees'
            },
            // Ensure Y-axis only shows whole numbers
            ticks: {
                stepSize: 1,
                precision: 0
            }
          }
        },
        plugins: {
            title: {
                display: true,
                text: 'Monthly Attendance Overview',
                font: {
                    size: 20,
                    weight: 'bold'
                }
            },
            tooltip: {
                mode: 'index',
                intersect: false
            }
        },
        hover: {
            mode: 'nearest',
            intersect: true
        }
      }
    });
  });
</script>

{% endblock %}

{% extends 'hr/officer/officer_base.html' %}
{% block title %}HR Admin - Import Attendance{% endblock %}

{% block content %}
<main class="content-wrap">
  <header class="content-head">
    <h1><b>Import Attendance Records</b></h1>
  </header>

  <!-- Upload Form -->
  <div class="upload-box">
    <form method="post" enctype="multipart/form-data">
      <div class="input-field">
        <label for="file">Choose Excel File (.xls or .xlsx)</label>
        <input type="file" name="file" id="file" accept=".xlsx,.xls" required />
      </div>
      <button type="submit" class="btn-upload">Upload</button>
    </form>
  </div>

  <!-- Preview Table -->
  {% if preview %}
  <div class="table-container" style="margin-top: 20px;">
    <caption><b>Preview Attendance Records</b></caption>
    <form method="post" action="{{ url_for('officer.confirm_bulk_attendance') }}">
      <table class="table table-bordered table-striped">
        <thead>
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Department</th>
            <th>Day</th>
            <th>Time In</th>
            <th>Time Out</th>
            <th>Matched</th>
          </tr>
        </thead>
        <tbody>
          {% for row in preview %}
          <tr {% if not row['Matched'] %} style="background-color:#fdd;" {% endif %}>
            <td>{{ row['Employee ID'] }}</td>
            <td>{{ row['Name'] }}</td>
            <td>{{ row['Department'] }}</td>
            <td>{{ row['Day'] }}</td>
            <td>{{ row['Time In'] }}</td>
            <td>{{ row['Time Out'] }}</td>
            <td style="text-align:center;">
              {% if row['Matched'] %}
                ✅
              {% else %}
                ❌
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      <div style="text-align: right; margin-top: 10px;">
        <button type="submit" class="btn-upload">Confirm Import</button>
      </div>
    </form>
  </div>
  {% endif %}
</main>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
document.addEventListener("DOMContentLoaded", function () {
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        Swal.fire({
          icon: "{{ 'success' if category == 'success' else 'error' if category == 'danger' else 'info' }}",
          title: "{{ category|capitalize }}",
          html: "{{ message|safe }}",
          confirmButtonColor: '#3085d6',
        });
      {% endfor %}
    {% endif %}
  {% endwith %}
});
</script>
{% endblock %}

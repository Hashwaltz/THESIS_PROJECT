{% extends "hr/officer/officer_base.html" %}
{% block title %}Late Computation{% endblock %}

{% block content %}
<main class="p-4 md:p-6 space-y-6 bg-gray-50">

  <!-- Page Header -->
  <header class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4">
    <h1 class="text-2xl font-semibold text-blue-400 flex items-center gap-2">
      <i class="fa-solid fa-clock text-3xl"></i>
      Monthly Late & Undertime
    </h1>
  </header>

  <!-- Filters -->
  <form method="get" class="flex flex-col md:flex-row gap-4 items-start md:items-end bg-gray-800 p-4 rounded-2xl shadow border border-gray-700">

    <div class="flex flex-col gap-2 w-full md:w-auto">
      <label class="text-gray-400">Month</label>
      <select name="month" class="bg-gray-700 text-gray-200 rounded-lg px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-400">
        {% for m in range(1,13) %}
          <option value="{{ m }}" {% if m == month %}selected{% endif %}>{{ datetime(2000, m, 1).strftime('%B') }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="flex flex-col gap-2 w-full md:w-auto">
      <label class="text-gray-400">Year</label>
      <select name="year" class="bg-gray-700 text-gray-200 rounded-lg px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-400">
        {% for y in range(2020, datetime.now().year + 1) %}
          <option value="{{ y }}" {% if y == year %}selected{% endif %}>{{ y }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="flex w-full md:w-auto">
      <button type="submit"
              class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded-xl flex items-center gap-2 w-full md:w-auto justify-center transition">
        <i class="fa-solid fa-filter"></i>
        <span class="hidden sm:inline">Filter</span>
      </button>
    </div>

  </form>

  <!-- Late Computation Table -->
  <div class="overflow-x-auto bg-gray-800 rounded-2xl shadow border border-gray-700">
    <table class="min-w-max table-auto text-sm md:text-base border-collapse">
      <thead class="bg-gray-900 text-gray-400 uppercase text-[10px] sticky top-0 z-10">
        <tr>
          <th class="px-1 py-1 text-left sticky left-0 bg-gray-900 z-20">NAME</th>
          <th class="px-1 py-1 text-left sticky left-[120px] bg-gray-900 z-20">CATEGORY</th>
          <th class="px-1 py-1 text-center">TOTAL LATE</th>
          <th class="px-1 py-1 text-center">NO. OF DAYS LATE</th>
          <th class="px-1 py-1 text-center">LATE DEDUCTION</th>
          <th class="px-1 py-1 text-center">TOTAL UNDERTIME</th>
          <th class="px-1 py-1 text-center">NO. OF DAYS UNDERTIME</th>
          <th class="px-1 py-1 text-center">UNDERTIME DEDUCTION</th>
          <th class="px-1 py-1 text-center">OVER-ALL TOTAL UNDERTIME/LATE</th>
          <th class="px-1 py-1 text-center">OVER-ALL TOTAL NO. OF DAYS</th>
          <th class="px-1 py-1 text-center">OVER-ALL TOTAL DEDUCTION</th>
          {% for d in range(1, days_in_month + 1) %}
            <th colspan="4" class="px-1 py-1 text-center">DAY {{ d }}</th>
          {% endfor %}
        </tr>
        <tr class="bg-gray-800 text-gray-400 text-[9px]">
          <th class="px-1 py-1 sticky left-0 bg-gray-800 z-20"></th>
          <th class="px-1 py-1 sticky left-[120px] bg-gray-800 z-20"></th>
          {% for d in range(1, days_in_month + 1) %}
            <th class="px-1 py-1 text-center">TIME IN</th>
            <th class="px-1 py-1 text-center">LATE</th>
            <th class="px-1 py-1 text-center">TIME OUT</th>
            <th class="px-1 py-1 text-center">UNDER TIME</th>
          {% endfor %}
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-700 text-gray-200">
        {% for row in data %}
        <tr class="hover:bg-gray-700 transition">
          <td class="px-1 py-1 sticky left-0 bg-gray-800 z-10">{{ row.employee.get_full_name() }}</td>
          <td class="px-1 py-1 sticky left-[120px] bg-gray-800 z-10">{{ row.employee.employment_type.name }}</td>

          <td class="px-1 py-1 text-center">{{ row.total_late_minutes }}</td>
          <td class="px-1 py-1 text-center">{{ "%.3f"|format(row.total_late_minutes / 480) }}</td>
          <td class="px-1 py-1 text-center">-</td>

          <td class="px-1 py-1 text-center">{{ row.total_undertime_minutes }}</td>
          <td class="px-1 py-1 text-center">{{ "%.3f"|format(row.total_undertime_minutes / 480) }}</td>
          <td class="px-1 py-1 text-center">-</td>

          <td class="px-1 py-1 text-center">{{ row.total_late_minutes + row.total_undertime_minutes }}</td>
          <td class="px-1 py-1 text-center">{{ "%.3f"|format((row.total_late_minutes + row.total_undertime_minutes)/480) }}</td>
          <td class="px-1 py-1 text-center">-</td>

          {% for d in range(1, days_in_month + 1) %}
            {% set day = row.days.get(d) %}
            <td class="px-1 py-1 text-center">{{ day.time_in if day else '-' }}</td>
            <td class="px-1 py-1 text-center">{{ day.late if day else '-' }}</td>
            <td class="px-1 py-1 text-center">{{ day.time_out if day else '-' }}</td>
            <td class="px-1 py-1 text-center">{{ day.undertime if day else '-' }}</td>
          {% endfor %}
        </tr>
        {% else %}
        <tr>
          <td colspan="{{ 11 + (days_in_month * 4) }}" class="px-1 py-1 text-center text-gray-400">
            No records found.
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

</main>
{% endblock %}

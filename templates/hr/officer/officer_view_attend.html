{% extends 'hr/officer/officer_base.html' %}
{% block title %}HR Officer - Employee Attendance{% endblock %}

{% block content %}
<main class="content-wrap">
  <header class="content-head">
    <h1><b>Employee Attendance</b></h1>
  </header>

  <!-- Filter Form -->
  <div class="filter-container searching">
    <form method="get" id="attendanceFilterForm">
      <div class="fields">
        <div class="input-field">
          <input type="date" id="date_filter" name="date" value="{{ date_filter }}">
        </div>

        <div class="input-field">
          <select id="employee_filter" name="employee">
            <option value="">Search by Employee</option>
            {% for emp in employees %}
              <option value="{{ emp.id }}" {% if emp.id|string == employee_filter %}selected{% endif %}>
                {{ emp.get_full_name() }}
              </option>
            {% endfor %}
          </select>
        </div>
      </div>
    </form>
  </div>

  <!-- Attendance Table -->
  <div class="table-container">
    <table>
      <caption><b>Attendance Records</b></caption>
      <thead>
        <tr>
          <th>Employee ID</th>
          <th>Full Name</th>
          <th>Date</th>
          <th>Time In</th>
          <th>Time Out</th>
          <th>Status</th>
          <th>Remarks</th>
        </tr>
      </thead>
      <tbody>
        {% for att in attendances.items %}
        <tr>
          <td data-label="Employee ID">{{ att.employee.employee_id }}</td>
          <td data-label="Full Name">{{ att.employee.get_full_name() }}</td>
          <td data-label="Date">{{ att.date.strftime('%Y-%m-%d') }}</td>
          <td data-label="Time In">{{ att.time_in.strftime('%H:%M') if att.time_in else '-' }}</td>
          <td data-label="Time Out">{{ att.time_out.strftime('%H:%M') if att.time_out else '-' }}</td>
          <td data-label="Status">
            <span class="{% if att.status == 'Present' %}status-present{% elif att.status == 'Absent' %}status-absent{% else %}status-late{% endif %}">
              {{ att.status }}
            </span>
          </td>
          <td data-label="Remarks">{{ att.remarks or '-' }}</td>
        </tr>
        {% else %}
        <tr>
          <td colspan="7">No attendance records found.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <!-- Pagination -->
    <div class="pagination">
      {% if attendances.has_prev %}
        <a href="{{ url_for('officer.attendance', page=attendances.prev_num, date=date_filter, employee=employee_filter) }}">Previous</a>
      {% endif %}
      <span class="page-info">Page {{ attendances.page }} of {{ attendances.pages }}</span>
      {% if attendances.has_next %}
        <a href="{{ url_for('officer.attendance', page=attendances.next_num, date=date_filter, employee=employee_filter) }}">Next</a>
      {% endif %}
    </div>
  </div>
</main>

<style>
/* Status colors */
.status-present { color: #28a745; font-weight: bold; } /* green */
.status-late { color: #ffc107; font-weight: bold; }   /* yellow */
.status-absent { color: #dc3545; font-weight: bold; } /* red */
</style>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const form = document.getElementById('attendanceFilterForm');
    const employeeSelect = document.getElementById('employee_filter');
    const dateInput = document.getElementById('date_filter');

    // Auto-submit when employee changes
    employeeSelect.addEventListener('change', function() {
        form.submit();
    });

    // Auto-submit when date changes
    dateInput.addEventListener('change', function() {
        form.submit();
    });
});
</script>
{% endblock %}

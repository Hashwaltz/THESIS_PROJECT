{% extends 'hr/officer/officer_base.html' %}
{% block title %}HR Officer - Employee Attendance{% endblock %}

{% block content %}
<main class="content-wrap">
  <header class="content-head">
    <h1><b>Employee Attendance</b></h1>
  </header>

  <!-- Filter Form -->
  <div class="search-container">
    <div class="filter-row">
        <!-- Start and End Date Filters -->
        <div class="input-field">
          <label>Start Date</label>
          <input type="date" id="start_date" name="start_date" value="{{ start_date }}">
        </div>
      

        <div class="input-field">
          <label>End Date</label>
          <input type="date" id="end_date" name="end_date" value="{{ end_date }}">
        </div>

        <!-- Submit Button -->
        <button type="submit" class="printing">
          <span class="material-symbols-outlined">
              database_search
          </span>
          Filter
        </button>
        
      </div>
    <form method="get" id="attendanceFilterForm">
      <div class="filter-row">
        
        <!-- Department Filter -->
        <div class="input-field">
          <select id="department_filter" name="department">
            <option value="">All Departments</option>
            {% for dept in departments %}
              <option value="{{ dept.id }}" {% if dept.id|string == department_filter %}selected{% endif %}>
                {{ dept.name }}
              </option>
            {% endfor %}
          </select>
        </div>

        <!-- Employee Filter -->
        <div class="input-field">
          <select id="employee_filter" name="employee">
            <option value="">All Employees</option>
            {% for emp in employees %}
              <option value="{{ emp.id }}" {% if emp.id|string == employee_filter %}selected{% endif %}>
                {{ emp.get_full_name() }}
              </option>
            {% endfor %}
          </select>
        </div>
      </div>

      
    </form>
  </div>

  <!-- Attendance Table -->
  <div class="table-container">
    <table>
      <caption><b>Attendance Records</b></caption>
      <thead>
        <tr>
          <th>Full Name</th>
          <th>Department</th>
          <th>Date</th>
          <th>Time In</th>
          <th>Time Out</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
        {% for att in attendances.items %}
        <tr>
          <td data-label="Full Name">{{ att.employee.get_full_name() }}</td>
          <td data-label="Department">{{ att.employee.department.name if att.employee.department else '-' }}</td>
          <td data-label="Date">{{ att.date.strftime('%Y-%m-%d') }}</td>
          <td data-label="Time In">{{ att.time_in.strftime('%H:%M') if att.time_in else '-' }}</td>
          <td data-label="Time Out">{{ att.time_out.strftime('%H:%M') if att.time_out else '-' }}</td>
          <td data-label="Status">
            <span class="{% if att.status == 'Present' %}status-present{% elif att.status == 'Absent' %}status-absent{% else %}status-late{% endif %}">
              {{ att.status }}
            </span>
          </td>
        </tr>
        {% else %}
        <tr>
          <td colspan="7">No attendance records found.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <!-- Pagination -->
    <div class="pagination">
      {% if attendances.has_prev %}
        <a href="{{ url_for('officer.attendance', page=attendances.prev_num, start_date=start_date, end_date=end_date, department=department_filter, employee=employee_filter) }}">Previous</a>
      {% endif %}
      <span class="page-info">Page {{ attendances.page }} of {{ attendances.pages }}</span>
      {% if attendances.has_next %}
        <a href="{{ url_for('officer.attendance', page=attendances.next_num, start_date=start_date, end_date=end_date, department=department_filter, employee=employee_filter) }}">Next</a>
      {% endif %}
    </div>
  </div>
</main>

<style>
/* Status colors */
.status-present { color: #28a745; font-weight: bold; } /* green */
.status-late { color: #ffc107; font-weight: bold; }   /* yellow */
.status-absent { color: #dc3545; font-weight: bold; } /* red */
</style>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const form = document.getElementById('attendanceFilterForm');
  const employeeSelect = document.getElementById('employee_filter');
  const deptSelect = document.getElementById('department_filter');
  const startDate = document.getElementById('start_date');
  const endDate = document.getElementById('end_date');

  // Auto-submit when filters change
  [employeeSelect, deptSelect, startDate, endDate].forEach(input => {
    input.addEventListener('change', () => form.submit());
  });
});
</script>
{% endblock %}

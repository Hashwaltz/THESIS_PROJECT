{% extends 'hr/officer/officer_base.html' %}
{% block title %}HR Officer - Edit Employee{% endblock %}

{% block content %}
<main class="content-wrap">
  <center>
    <div class="edit-container">
      <header><b>Employee Details</b></header>

      <form id="editForm" method="POST" action="{{ url_for('officer.edit_employee', employee_id=employee.id) }}">
        <div class="form first">
          <div class="details personal">
            <div class="fields">

              <div class="input-field">
                <label>First Name</label>
                <input type="text" name="first_name" value="{{ employee.first_name }}" readonly />
              </div>

              <div class="input-field">
                <label>Middle Name</label>
                <input type="text" name="middle_name" value="{{ employee.middle_name }}" readonly />
              </div>

              <div class="input-field">
                <label>Last Name</label>
                <input type="text" name="last_name" value="{{ employee.last_name }}" readonly />
              </div>

              <div class="input-field">
                <label>Email</label>
                <input type="email" name="email" value="{{ employee.email }}" readonly />
              </div>

              <div class="input-field">
                <label>Mobile Number</label>
                <input type="text" name="phone" value="{{ employee.phone }}" required />
              </div>

              <div class="input-field">
                <label>Address</label>
                <input type="text" name="address" value="{{ employee.address }}" required />
              </div>

              <div class="input-field">
                <label>Date of Birth</label>
                <input type="date" name="date_of_birth" 
                       value="{{ employee.date_of_birth.strftime('%Y-%m-%d') if employee.date_of_birth else '' }}" readonly />
              </div>

              <div class="input-field">
                <label>Date Hired</label>
                <input type="date" name="date_hired" 
                       value="{{ employee.date_hired.strftime('%Y-%m-%d') if employee.date_hired else '' }}" readonly />
              </div>

              <div class="input-field">
                <label>Position</label>
                <select name="position" disabled>
                  {% for pos in positions %}
                    <option value="{{ pos.id }}" {% if employee.position_id == pos.id %}selected{% endif %}>{{ pos.name }}</option>
                  {% endfor %}
                </select>
              </div>

              <div class="input-field">
                <label>Gender</label>
                <select name="gender" disabled>
                  <option value="Male" {% if employee.gender == 'Male' %}selected{% endif %}>Male</option>
                  <option value="Female" {% if employee.gender == 'Female' %}selected{% endif %}>Female</option>
                </select>
              </div>

              <div class="input-field">
                <label>Marital Status</label>
                <select name="marital_status" required>
                  <option value="Single" {% if employee.marital_status == 'Single' %}selected{% endif %}>Single</option>
                  <option value="Married" {% if employee.marital_status == 'Married' %}selected{% endif %}>Married</option>
                  <option value="Separated" {% if employee.marital_status == 'Separated' %}selected{% endif %}>Separated</option>
                  <option value="Divorced" {% if employee.marital_status == 'Divorced' %}selected{% endif %}>Divorced</option>
                  <option value="Widowed" {% if employee.marital_status == 'Widowed' %}selected{% endif %}>Widowed</option>
                </select>
              </div>

              <div class="input-field">
                <label>Department</label>
                <select name="department" disabled>
                  {% for dept in departments %}
                    <option value="{{ dept.id }}" {% if employee.department_id == dept.id %}selected{% endif %}>{{ dept.name }}</option>
                  {% endfor %}
                </select>
              </div>

              <div class="input-field">
                <label>Status</label>
                <select name="status" disabled>
                  <option value="1" {% if employee.active %}selected{% endif %}>Active</option>
                  <option value="0" {% if not employee.active %}selected{% endif %}>Inactive</option>
                </select>
              </div>

              <div class="input-field">
                <label>Emergency Contact Name</label>
                <input type="text" name="emergency_contact" value="{{ employee.emergency_contact }}" required />
              </div>

              <div class="input-field">
                <label>Emergency Contact Number</label>
                <input type="text" name="emergency_phone" value="{{ employee.emergency_phone }}" required />
              </div>
            </div>
          </div>

         <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px;">
            <!-- Update Button -->
            <button type="submit" class="printing" style="background-color: #007bff; color: #fff;">
              <span class="material-symbols-outlined">
                update
              </span>
              Update
            </button>

            <!-- Cancel Button -->
            <button type="button" class="printing" style="background: #FF6347; color:#fff" id="cancelBtn">
              <span class="material-symbols-outlined">
              cancel
              </span>
              Cancel
            </button>
          </div>

        </div>
      </form>
    </div>
  </center>
</main>

<!-- SweetAlert CDN -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
  // SweetAlert confirmation + redirect
  document.getElementById('editForm').addEventListener('submit', async function (e) {
    e.preventDefault();
    const form = e.target;

    const confirm = await Swal.fire({
      title: 'Confirm Update',
      text: 'Are you sure you want to save changes?',
      icon: 'question',
      showCancelButton: true,
      confirmButtonText: 'Yes, update it!',
      cancelButtonText: 'Cancel',
      confirmButtonColor: '#3085d6',
      cancelButtonColor: '#d33'
    });

    if (!confirm.isConfirmed) return;

    const response = await fetch(form.action, {
      method: 'POST',
      body: new FormData(form),
    });

    const result = await response.json();

    if (result.status === 'success') {
      Swal.fire({
        icon: 'success',
        title: 'Updated!',
        text: result.message,
        showConfirmButton: false,
        timer: 2000
      }).then(() => {
        window.location.href = "{{ url_for('officer.employees') }}";
      });
    } else {
      Swal.fire({
        icon: 'error',
        title: 'Error',
        text: result.message
      });
    }
  });


    // Cancel button confirmation
  document.getElementById('cancelBtn').addEventListener('click', async () => {
    const confirm = await Swal.fire({
      title: 'Cancel Editing?',
      text: 'Unsaved changes will be lost. Continue?',
      icon: 'warning',
      showCancelButton: true,
      confirmButtonText: 'Yes, cancel',
      cancelButtonText: 'Stay on page',
      confirmButtonColor: '#d33',
      cancelButtonColor: '#3085d6'
    });

    if (confirm.isConfirmed) {
      window.location.href = "{{ url_for('officer.employees') }}";
    }
  });
</script>
{% endblock %}

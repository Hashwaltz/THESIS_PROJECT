{% extends 'payroll/admin/payroll_admin_base.html' %} {% block title %}HR Admin
- Deductions{% endblock %} {% block content %}
<main class="content-wrap">
  <header class="content-head">
    <h1><b>Deductions</b></h1>
  </header>

  <div class="searching">
    <form
      method="post"
      action="{{ url_for('payroll_admin.deductions') }}"
      class="search-form"
    >
      <div class="fields">
        <div class="input-field">
          <input
            type="text"
            name="search"
            value="{{ search }}"
            placeholder="Search deductions..."
          />
          <button
            type="submit"
            style="display: flex; align-items: center; gap: 6px"
          >
            <span class="material-symbols-outlined" style="font-size: 30px"
              >search</span
            >
            Search
          </button>
          <button
            type="button"
            class="btn btn-primary printing"
            style="display: flex; align-items: center; gap: 6px"
            onclick="window.location.href='{{ url_for('payroll_admin.add_deduction') }}'"
          >
            <span class="material-symbols-outlined" style="font-size: 30px"
              >add</span
            >
            Add Deduction
          </button>
        </div>
      </div>
    </form>
  </div>

  <div class="table-container">
    <div class="centered-container">
      <table class="responsive-table">
        <caption>
          <b>Deduction List</b>
        </caption>
        <thead>
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Description</th>
            <th>Type</th>
            <th>Amount</th>
            <th>Percentage</th>
            <th>Mandatory</th>
            <th>Active</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for deduction in deductions %}
          <tr>
            <td data-label="ID">{{ deduction.id }}</td>
            <td data-label="Name">{{ deduction.name }}</td>
            <td data-label="Description">{{ deduction.description }}</td>
            <td data-label="Type">{{ deduction.type }}</td>
            <td data-label="Amount">
              â‚± {{ "{:,.2f}".format(deduction.amount) }}
            </td>
            <td data-label="Percentage">{{ deduction.percentage }}%</td>
            <td data-label="Mandatory">
              {{ 'Yes' if deduction.is_mandatory else 'No' }}
            </td>
            <td data-label="Active">
              {{ 'Active' if deduction.active else 'Inactive' }}
            </td>
            <td data-label="Actions">
              <a
                href="#"
                class="btn-action open-deduction-modal"
                data-id="{{ deduction.id }}"
              >
                Edit
              </a>
              <form action="#" method="POST" style="display: inline">
                <button
                  type="submit"
                  onclick="return confirm('Are you sure you want to delete this deduction?')"
                >
                  Delete
                </button>
              </form>
            </td>
          </tr>
          {% else %}
          <tr>
            <td colspan="9">No deductions found.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

      <!-- Pagination -->
      <div class="pagination">
        {% if pagination.has_prev %}
        <a
          href="{{ url_for('payroll_admin.deductions', page=pagination.prev_num, search=search) }}"
          >Previous</a
        >
        {% endif %} Page {{ pagination.page }} of {{ pagination.pages }} {% if
        pagination.has_next %}
        <a
          href="{{ url_for('payroll_admin.deductions', page=pagination.next_num, search=search) }}"
          >Next</a
        >
        {% endif %}
      </div>

      <!-- Deduction Modal -->
      <div id="deductionModal" class="modal">
        <div class="modal-content">
          <div
            class="modal-header"
            style="display: flex; justify-content: space-between"
          >
            <h2 style="color: #495057">Edit Deduction</h2>
            <span class="modal-close" style="font-size: 40px; cursor: pointer"
              >&times;</span
            >
          </div>
          <div class="modal-body" id="deduction-modal-body">
            <!-- Edit form will be loaded here -->
          </div>
        </div>
      </div>
    </div>
  </div>
</main>
<script>
document.addEventListener("DOMContentLoaded", function () {
  const modal = document.getElementById("deductionModal");
  const modalBody = document.getElementById("deduction-modal-body");
  const closeBtn = document.querySelector(".modal-close");

  document.querySelectorAll(".open-deduction-modal").forEach((btn) => {
    btn.addEventListener("click", function (e) {
      e.preventDefault();
      const deductionId = this.getAttribute("data-id");

      const baseUrl = "{{ url_for('payroll_admin.edit_deduction', deduction_id=0) }}";
      const url = baseUrl.replace("0", deductionId);

      fetch(url, {
        headers: { "X-Requested-With": "XMLHttpRequest" }
      })
        .then(res => res.text())
        .then(html => {
          modalBody.innerHTML = html;
          modal.style.display = "block";
        });
    });
  });

  closeBtn.addEventListener("click", () => {
    modal.style.display = "none";
  });

  window.addEventListener("click", (e) => {
    if (e.target == modal) modal.style.display = "none";
  });
});
</script>

{% endblock %}

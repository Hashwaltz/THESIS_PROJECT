{% extends 'payroll/admin/payroll_admin_base.html' %}
{% block title %}Payroll Admin - Payroll Periods{% endblock %}

{% block content %}
<main class="content-wrap">
  <header class="content-head">
    <h1><b>Payroll Periods</b></h1>
  </header>

  <div class="table-container">
    <div class="centered-container">

     <!-- Filter Form -->
<form method="GET" class="searching" style="margin-bottom: 1rem; display: flex; gap: 1rem; flex-wrap: wrap;">
  <div class="input-field">
    <label for="status">Status:</label>
    <select name="status" id="status">
      <option value="">All</option>
      <option value="Open" {% if request.args.get('status') == 'Open' %}selected{% endif %}>Open</option>
      <option value="Processing" {% if request.args.get('status') == 'Processing' %}selected{% endif %}>Processing</option>
      <option value="Closed" {% if request.args.get('status') == 'Closed' %}selected{% endif %}>Closed</option>
    </select>
  </div>

  <div class="input-field">
    <label for="start_date">Start Date From:</label>
    <input type="date" name="start_date" id="start_date" value="{{ request.args.get('start_date', '') }}">
  </div>

  <div class="input-field">
    <label for="end_date">End Date To:</label>
    <input type="date" name="end_date" id="end_date" value="{{ request.args.get('end_date', '') }}">
  </div>
</form>

<!-- Add New Period Button -->
<div class="add-attendance-container">
  <a href="{{ url_for('payroll_admin.add_payroll_period') }}" class="btn-primary">+ Add Payroll Period</a>
</div>


      <!-- Payroll Periods Table -->
      <table class="responsive-table">
        <caption><b>Payroll Period List</b></caption>
        <thead>
          <tr>
            <th>Period Name</th>
            <th>Start Date</th>
            <th>End Date</th>
            <th>Pay Date</th>
            <th>Status</th>
            <th>Created At</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for period in periods %}
          <tr>
            <td data-label="Period Name">{{ period.period_name }}</td>
            <td data-label="Start Date">{{ period.start_date.strftime('%b %d, %Y') }}</td>
            <td data-label="End Date">{{ period.end_date.strftime('%b %d, %Y') }}</td>
            <td data-label="Pay Date">{{ period.pay_date.strftime('%b %d, %Y') }}</td>
            <td data-label="Status">
              <span style="color:
                {% if period.status == 'Open' %}green
                {% elif period.status == 'Processing' %}orange
                {% else %}red
                {% endif %};
                font-weight: bold;">
                {{ period.status }}
              </span>
            </td>
            <td data-label="Created At">{{ period.created_at.strftime('%b %d, %Y') }}</td>
            <td data-label="Actions">
              <!-- Edit button -->
              <a href="{{ url_for('payroll_admin.edit_payroll_period', period_id=period.id) }}" class="btn-action edit">
                <span class="material-symbols-outlined">edit</span>
                <span class="btn-text">Edit</span>
              </a>
            </td>

          </tr>
          {% else %}
          <tr>
            <td colspan="8">No payroll periods found.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

      <!-- Pagination -->
<div class="pagination" style="margin-top: 1rem; text-align: center;">
  {% if pagination.has_prev %}
    <a href="{{ url_for('payroll_admin.view_payroll_periods', page=pagination.prev_num, status=request.args.get('status',''), start_date=request.args.get('start_date',''), end_date=request.args.get('end_date','')) }}">
      Previous
    </a>
  {% endif %}

  Page {{ pagination.page }} of {{ pagination.pages }}

  {% if pagination.has_next %}
    <a href="{{ url_for('payroll_admin.view_payroll_periods', page=pagination.next_num, status=request.args.get('status',''), start_date=request.args.get('start_date',''), end_date=request.args.get('end_date','')) }}">
      Next
    </a>
  {% endif %}
</div>

    </div>
  </div>
</main>
{% endblock %}

{% extends 'hr/admin/admin_base.html' %}
{% block title %}HR-Admin Edit{% endblock %}

{% block content %}
<main class="content-wrap">
  <header class="content-head">
    <h1><b>Edit Employee Information</b></h1>
  </header>

  <div class="container">
    <header>Employee Details</header>
      <!-- ðŸ”¹ Flash messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-messages">
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }}">
                            {{ message }}
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}
        
    <!-- IMPORTANT: method="POST" so Flask receives form data -->
    <form method="POST" action="{{ url_for('hr_admin.edit_employee', employee_id=employee.id) }}">
      <div class="form first">
        <div class="details personal">
          <div class="fields">

            <div class="input-field">
              <label>First Name</label>
              <input type="text" name="first_name" value="{{ employee.first_name }}" required />
            </div>

            <div class="input-field">
              <label>Middle Name</label>
              <input type="text" name="middle_name" value="{{ employee.middle_name}}" />
            </div>

            <div class="input-field">
              <label>Last Name</label>
              <input type="text" name="last_name" value="{{ employee.last_name}}" required />
            </div>

            <div class="input-field">
              <label>Email</label>
              <input type="email" name="email" value="{{ employee.email }}" required />
            </div>

            <div class="input-field">
              <label>Mobile Number</label>
              <input type="text" name="phone" value="{{ employee.phone}}" required />
            </div>

            <div class="input-field">
              <label>Address</label>
              <input type="text" name="address" value="{{ employee.address }}" required />
            </div>

            <div class="input-field">
              <label>Salary</label>
              <input type="text" name="salary" id="salary" value="{{ employee.salary}}" required />
            </div>

            <div class="input-field">
              <label>Date of Birth</label>
              <input type="date" name="date_of_birth" value="{{ employee.date_of_birth }}" required />
            </div>

            <div class="input-field">
              <label>Date Hired</label>
              <input type="date" name="date_hired" value="{{ employee.date_hired }}" required />
            </div>

            <div class="input-field">
              <label>Position</label>
              <select name="position" required>
                <option disabled selected></option>
                {% for pos in positions %}
                  <option value="{{ pos.id }}" {% if employee.position_id == pos.id %}selected{% endif %}>
                        {{ pos.name }}
                    </option>
                {% endfor %}  
              </select>
            </div>

            <div class="input-field">
              <label>Gender</label>
              <select name="gender" required>
                <option disabled selected>Select gender</option>
                <option value="Male" {% if employee.gender == 'Male' %}selected{% endif %}>Male</option>
                <option value="Female" {% if employee.gender == 'Female' %}selected{% endif %}>Female</option>
              </select>
            </div>

            <div class="input-field">
              <label>Marital Status</label>
              <select name="marital_status" required>
                <option disabled selected>Select status</option>
                <option value="Single" {% if employee.marital_status == 'Single'%}selected{% endif %}>Single</option>
                <option value="Married" {% if employee.marital_status == 'Married'%}selected{% endif %}>Married</option>
                <option value="Separated" {% if employee.marital_status == 'Separated'%}selected{% endif %}>Separated</option>
                <option value="Divorced" {% if employee.marital_status == 'Divorced'%}selected{% endif %}>Divorced</option>
                <option value="Widowed" {% if employee.marital_status == 'Widowed'%}selected{% endif %}>Widowed</option>
              </select>
            </div>

            <div class="input-field">
              <label>Department</label>
              <select name="department" required>
                <option disabled selected>Select dept</option>
                {% for dept in departments %}
                  <option value="{{ dept.id }}" {% if employee.department_id == dept.id %}selected{% endif %}>
                        {{ dept.name }}
                  </option>
                {% endfor %}
              </select>
            </div>

            <div class="input-field">
              <label>Emergency Contact Name</label>
              <input type="text" name="emergency_contact" value="{{ employee.emergency_contact}}" required />
            </div>

            <div class="input-field">
              <label>Emergency Contact Number</label>
              <input type="text" name="emergency_phone" value="{{ employee.emergency_contact }}" required />
            </div>
          </div>
        </div>

        <button type="submit" class="submit">
          <span class="btnText">Submit</span>
          <i class="uil uil-navigator"></i>
        </button>
      </div>
    </form>
  </div>
</main>
{% endblock %}

{% block scripts %}
<script>
const salaryInput = document.getElementById("salary");

// Format with commas while typing
salaryInput.addEventListener("input", function (e) {
  // Strip out commas
  let rawValue = e.target.value.replace(/,/g, "");

  // Allow only digits
  if (/^\d*$/.test(rawValue)) {
    // Format with commas
    e.target.value = rawValue ? Number(rawValue).toLocaleString() : "";
  }
});

// Before submitting, remove commas so DB gets a number
salaryInput.form.addEventListener("submit", function () {
  salaryInput.value = salaryInput.value.replace(/,/g, "");
});
</script>
{% endblock%}
{% extends 'hr/admin/admin_base.html' %} {% block title %}HR Admin - View
Users{% endblock %} {% block content %}
<main class="content-wrap">
  
  <header class="content-head">
    <h1><b>View All Users</b></h1>
  </header>

  <div class="table-container">
    <div class="centered-container">
      <table class="responsive-table">
        <caption>
          <b>Users List</b>
        </caption>
        <thead>
          <tr>
            <th>User ID</th>
            <th>Full Name</th>
            <th>Email</th>
            <th>Role</th>  
            <th>Last Login</th>
            <th>Active</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for user in users %}
          <tr>
            <td data-label="User ID">{{ user.id }}</td>
            <td data-label="Full Name">{{ user.get_full_name() }}</td>
            <td data-label="Email">{{ user.email }}</td>
            <td data-label="Role">{{ user.role or '-' }}</td>
             <td data-label="Date Hired">
              {{ user.last_login.strftime('%Y-%m-%d') if user.last_login
              else '-' }}
            </td>
            <td data-label="Status">
            <span style="color: {{ 'green' if user.active else 'red' }};">
              {{ 'Active' if user.active else 'Inactive' }}
            </span>
          </td>
            <td data-label="Actions">
              <a href="#" class="btn-action open-modal" data-id="{{ user.id }}">
                View | Edit
              </a>
            </td>
          </tr>
          {% else %}
          <tr>
            <td colspan="6">No users found.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>


      <!-- Pagination -->
      <div class="pagination">
        {% if users.has_prev %}
        <a href="{{ url_for('hr_admin_bp.view_users', page=users.prev_num) }}"
          >Previous</a
        >
        {% endif %} Page {{ users.page }} of {{ users.pages }} {% if
        users.has_next %}
        <a href="{{ url_for('hr_admin_bp.view_users', page=users.next_num) }}"
          >Next</a
        >
        {% endif %}
      </div>
    </div>
  </div>
  
</main>

<!-- Modal -->
<div id="employeeModal" class="modal">
  <div class="modal-content">
    <div
      class="modal-header"
      style="display: flex; flex-direction: row; justify-content: space-between"
    >
      <h2 style="text-align: left; width: 100%; color: #495057">
        Edit User
      </h2>
      <span
        class="modal-close"
        style="font-size: 50px; cursor: pointer; color: #495057"
        >&times;</span
      >
    </div>
    <div class="modal-body" id="modal-body">
      <!-- Form will be loaded here dynamically -->
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const modal = document.getElementById("employeeModal");
    const modalBody = document.getElementById("modal-body");
    const closeBtn = document.querySelector(".modal-close");

    document.querySelectorAll(".open-modal").forEach((btn) => {
      btn.addEventListener("click", function (e) {
        e.preventDefault();
        const empId = this.getAttribute("data-id");

        const baseUrl = "{{ url_for('hr_admin.edit_user', user_id=0) }}";
        const url = baseUrl.replace("0", empId);

        fetch(url, {
          headers: { "X-Requested-With": "XMLHttpRequest" },
        })
          .then((res) => res.text())
          .then((html) => {
            modalBody.innerHTML = html;
            modal.style.display = "block";
          });
      });
    });

    closeBtn.addEventListener("click", () => {
      modal.style.display = "none";
    });

    window.addEventListener("click", (e) => {
      if (e.target == modal) modal.style.display = "none";
    });
  });
</script>
{% endblock %}

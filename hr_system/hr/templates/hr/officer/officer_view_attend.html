{# templates/hr/officer/officer_view_attendance.html #}
{% extends 'hr/officer/officer_base.html' %}
{% block title %}HR Officer - Employee Attendance{% endblock %}

{% block content %}
<main class="content-wrap">
  <header class="content-head">
    <h1><b>Employee Attendance</b></h1>
  </header>

  <!-- Filter Form -->
  <div class="filter-container">
    <form method="get" class="inline-form">
      <label for="date_filter">Date:</label>
      <input type="date" id="date_filter" name="date" value="{{ date_filter }}">
      
      <label for="employee_filter">Employee:</label>
      <select id="employee_filter" name="employee">
        <option value="">All</option>
        {% for emp in employees %}
          <option value="{{ emp.id }}" {% if emp.id|string == employee_filter %}selected{% endif %}>
            {{ emp.get_full_name() }}
          </option>
        {% endfor %}
      </select>

      <button type="submit" class="btn-action">Filter</button>
      <a href="{{ url_for('hr_officer.attendance') }}" class="btn-action">Reset</a>
    </form>
  </div>

  <!-- Mark / Correct Attendance -->
  <div class="add-attendance-container">
    <a href="{{ url_for('hr_officer.add_attendance') }}" class="btn-primary">Mark / Correct Attendance</a>
  </div>

  <!-- Attendance Table -->
  <div class="table-container">
    <div class="centered-container">
      <table class="responsive-table">
        <caption><b>Attendance Records</b></caption>
        <thead>
          <tr>
            <th>Employee ID</th>
            <th>Full Name</th>
            <th>Date</th>
            <th>Time In</th>
            <th>Time Out</th>
            <th>Status</th>
            <th>Remarks</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for att in attendances.items %}
          <tr class="{% if att.status == 'Present' %}present{% elif att.status == 'Absent' %}absent{% else %}late{% endif %}">
            <td data-label="Employee ID">{{ att.employee.employee_id }}</td>
            <td data-label="Full Name">{{ att.employee.get_full_name() }}</td>
            <td data-label="Date">{{ att.date.strftime('%Y-%m-%d') }}</td>
            <td data-label="Time In">{{ att.time_in.strftime('%H:%M') if att.time_in else '-' }}</td>
            <td data-label="Time Out">{{ att.time_out.strftime('%H:%M') if att.time_out else '-' }}</td>
            <td data-label="Status">{{ att.status }}</td>
            <td data-label="Remarks">{{ att.remarks or '-' }}</td>
            <td data-label="Actions" class="action-buttons">
              <a href="{{ url_for('hr_officer.edit_attendance', attendance_id=att.id) }}" class="btn-action edit-btn">Edit</a>
              <form action="{{ url_for('hr_officer.delete_attendance', attendance_id=att.id) }}" method="post" style="display:inline-block;" onsubmit="return confirm('Are you sure you want to delete this attendance record?');">
                <button type="submit" class="btn-action delete-btn">Delete</button>
              </form>
            </td>
          </tr>
          {% else %}
          <tr>
            <td colspan="8">No attendance records found.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

      <!-- Pagination -->
      <div class="pagination">
        {% if attendances.has_prev %}
          <a href="{{ url_for('hr_officer.attendance', page=attendances.prev_num, date=date_filter, employee=employee_filter) }}" class="page-link">Previous</a>
        {% endif %}

        <span class="page-info">Page {{ attendances.page }} of {{ attendances.pages }}</span>

        {% if attendances.has_next %}
          <a href="{{ url_for('hr_officer.attendance', page=attendances.next_num, date=date_filter, employee=employee_filter) }}" class="page-link">Next</a>
        {% endif %}
      </div>
    </div>
  </div>
</main>
{% endblock %}
